<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=/main.8eea9b71beda1575310e88d17ac79aea492cb5bff5f5200f7a1c3e1e650663f1a1c936a6654c061c012536cc53ee1bd37565a2870c09d7e287acd0f155bc7148.css integrity="sha512-juqbcb7aFXUxDojResea6kkstb/19SAPehw+HmUGY/GhyTamZUwGHAElNsxT7hvTdWWihwwJ1+KHrNDxVbxxSA==" crossorigin=anonymous><noscript><style>.collapse:not(.show){display:block}button.btn-toggle{cursor:unset}button.btn-toggle::before{display:none}.doks-subnavbar{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>How VSFilter renders border and shadow - Aegisub</title><meta name=description content="If you&amp;rsquo;ve ever used the \be or the new \blur tag you might wonder, why do they blur edges and not everything?
The answer lies in how VSFilter internally handles fill, border and shadow, and the relationship between them.
The basic component of a subtitle rendering is the fill. The fill is the main shape of the text, ie. what you see if you disable border and shadow. (When I write &amp;ldquo;text&amp;rdquo; here it can just as well be a vector drawing made with \p1."><link rel=canonical href=/blog/how-vsfilter-renders-border-and-shadow/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="How VSFilter renders border and shadow"><meta property="og:description" content="If you&rsquo;ve ever used the \be or the new \blur tag you might wonder, why do they blur edges and not everything?
The answer lies in how VSFilter internally handles fill, border and shadow, and the relationship between them.
The basic component of a subtitle rendering is the fill. The fill is the main shape of the text, ie. what you see if you disable border and shadow. (When I write &ldquo;text&rdquo; here it can just as well be a vector drawing made with \p1."><meta property="og:url" content="/blog/how-vsfilter-renders-border-and-shadow/"><meta property="og:site_name" content="Aegisub"><meta property="article:published_time" content="2008-07-25T03:00:00+01:00"><meta property="article:modified_time" content="2008-07-25T03:36:11+01:00"><meta property="og:image" content="/img/logo.png"><meta property="og:image:alt" content="Aegisub"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@aegisub"><meta name=twitter:creator content><meta name=twitter:title content="How VSFilter renders border and shadow"><meta name=twitter:description content><meta name=twitter:image content="/img/logo.png"><meta name=twitter:image:alt content="How VSFilter renders border and shadow"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"/#/schema/organization/1","name":"Aegisub","url":"/","sameAs":["https://twitter.com/aegisub","https://github.com/Aegisub/Aegisub"],"logo":{"@type":"ImageObject","@id":"/#/schema/image/1","url":"/logo-aegisub.png","width":512,"height":512,"caption":"Aegisub"},"image":{"@id":"/#/schema/image/1"}},{"@type":"WebSite","@id":"/#/schema/website/1","url":"/","name":"Aegisub","description":"Aegisub is a free, cross-platform open source tool for creating and modifying subtitles. Aegisub makes it quick and easy to time subtitles to audio, and features many powerful tools for styling them, including a built-in real-time video preview.","publisher":{"@id":"/#/schema/organization/1"}},{"@type":"WebPage","@id":"/blog/how-vsfilter-renders-border-and-shadow/","url":"/blog/how-vsfilter-renders-border-and-shadow/","name":"How VSFilter renders border and shadow","description":"","isPartOf":{"@id":"/#/schema/website/1"},"about":{"@id":"/#/schema/organization/1"},"datePublished":"2008-07-25T03:00:00CET","dateModified":"2008-07-25T03:36:11CET","breadcrumb":{"@id":"/blog/how-vsfilter-renders-border-and-shadow/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"/blog/how-vsfilter-renders-border-and-shadow/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["/blog/how-vsfilter-renders-border-and-shadow/"]}]},{"@type":"BreadcrumbList","@id":"/blog/how-vsfilter-renders-border-and-shadow/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"/","url":"/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@id":"/bloghow-vsfilter-renders-border-and-shadow/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"/#/schema/article/1","headline":"How VSFilter renders border and shadow","description":"","isPartOf":{"@id":"/blog/how-vsfilter-renders-border-and-shadow/"},"mainEntityOfPage":{"@id":"/blog/how-vsfilter-renders-border-and-shadow/"},"datePublished":"2008-07-25T03:00:00CET","dateModified":"2008-07-25T03:36:11CET","author":{"@id":"/#/schema/person/2"},"publisher":{"@id":"/#/schema/organization/1"},"image":{"@id":"/blog/how-vsfilter-renders-border-and-shadow/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"/#/schema/person/2","name":null,"sameAs":[]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"/blog/how-vsfilter-renders-border-and-shadow/#/schema/image/2","url":"/img/logo.png","contentUrl":"/img/logo.png","caption":"How VSFilter renders border and shadow"}]}]}</script><meta name=theme-color content="#fff"><link rel=icon href=/favicon.ico sizes=any><link rel=icon type=image/svg+xml href=/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=/site.webmanifest></head><body class="blog single"><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-md navbar-light doks-navbar"><nav class="container-fluid flex-wrap flex-md-nowrap" aria-label="Main navigation"><a class="navbar-brand p-0 me-auto" href=/ aria-label=Aegisub>Aegisub</a>
<button class="btn btn-menu d-block d-md-none order-5" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-md-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-md-none"></div><div class="offcanvas-header d-md-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/>Aegisub</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body px-4"><h3 class="h6 text-uppercase mb-3 d-md-none">Main</h3><ul class="nav flex-column flex-md-row ms-md-n3"><li class=nav-item><a class="nav-link ps-0 py-1" href=/downloads/>Downloads</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/docs/>Docs</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://github.com/Aegisub/Aegisub/issues>Bug Tracker</a></li><li class=nav-item><a class="nav-link ps-0 py-1 active" href=/blog/>Blog</a></li></ul><hr class="text-black-50 my-4 d-md-none"><h3 class="h6 text-uppercase mb-3 d-md-none">Socials</h3><ul class="nav flex-column flex-md-row ms-md-auto me-md-n5 pe-md-4"><li class=nav-item><a class="nav-link ps-0 py-1" href=https://github.com/Aegisub/Aegisub aria-label="View repository on GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-md-none">GitHub</small></a></li></ul></div></div><button id=mode class="btn btn-link order-md-1" type=button aria-label="Toggle user interface mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><div class="dropdown order-md-2"><button class="btn btn-doks-light dropdown-toggle" id=doks-languages data-bs-toggle=dropdown aria-expanded=false data-bs-display=static>
EN
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></button><ul class="dropdown-menu dropdown-menu-end shadow rounded border-0" aria-labelledby=doks-languages><li><a class="dropdown-item current" aria-current=true href=/blog/how-vsfilter-renders-border-and-shadow/>English</a></li><li><hr class=dropdown-divider></li><li><a class=dropdown-item rel=alternate href=/zh-cn hreflang=zh-cn lang=zh-cn>简体中文</a></li></ul></div></nav></header></div><div class="wrap container-fluid" role=document><div class=content><div class="row justify-content-center"><div class="col-md-12 col-lg-10 col-xl-8"><article><div class=blog-header><h1>How VSFilter renders border and shadow</h1><p><small>Posted July 25, 2008 by <a class="stretched-link position-relative" href=/contributors/jfs/>jfs</a>&nbsp;&dash;&nbsp;<strong>3&nbsp;min read</strong></small><p></div><p class=lead></p><p>If you&rsquo;ve ever used the \be or the new \blur tag you might wonder, why do they blur <em>edges</em> and not everything?</p><p><img class=img-fluid loading=lazy src=/img/blog/old/be-blur-demo.png width=424 height=163 alt="Example of how VSFilter blurs just edges and not everything"></p><p>The answer lies in how VSFilter internally handles fill, border and shadow, and the relationship between them.</p><p>The basic component of a subtitle rendering is the <em>fill</em>. The fill is the main shape of the text, ie. what you see if you disable border and shadow. (When I write &ldquo;text&rdquo; here it can just as well be a vector drawing made with \p1.)</p><p>I am keeping things simple here, there are some technical details in the actual implementation I&rsquo;m skipping over because they aren&rsquo;t relevant for the discussion, although they actually impact the actual algorithm used greatly. I might discuss the detailed algorithm later.</p><p>When I talk about bitmaps in this post, they are single-channel bitmaps, ie. black/white bitmaps. Colour is applied during the painting-step, this is described in detail below.</p><p>When a subtitle is to be rendered, VSFilter first creates a bitmap of the text fill. It then sees if the text should have a &ldquo;wide outline&rdquo;, ie. if a \bord tag is in effect. If there is a wide outline, it allocates an additional bitmap that will contain the <em>widened region</em>.</p><p>The <em>widened region</em> is the fill bitmap modified in a way so it&rsquo;s effectively &ldquo;embolded&rdquo;, ie. the outline is expanded outwards, but the entire fill is still kept.</p><p><img class=img-fluid loading=lazy src=/img/blog/old/fill-and-widened-region-concept.png width=388 height=105 alt="Visualisation of how the widened region is the fill expanded outwards by border size"></p><p>You might notice that the widened region looks a lot like the shadow. This is entirely correct, because it is used for rendering not just the border but also the shadow.</p><p>When the line is to be rendered, the fill bitmap is used as-is for fill, the widened region is used as-is for shadow, and the border is generated by subtracting the fill from the widened region, ie. the border is the part of the widened region that is not also in the fill.</p><p>Things work a little different when there is no border. In that case, the fill is painted as-is, but the shadow is also painted using the fill.</p><p>I wrote above that the fill and widened region bitmaps are black/white bitmaps, so what about colour? The bitmaps are simply re-coloured with the selcted colour during painting, or more correctly, used as alpha masks to paint a frame full of the colour.</p><p>Okay, so <strong>on to the blur effects</strong>.</p><p>The blur effects are applied to the bitmaps, either to the fill or to the widened region bitmap. If there is a widened region bitmap, it is applied to that one only and the fill is left alone. If there is no widened region (ie. no border) the blur is applied to only the fill bitmap.</p><p>This is why only the border blurs when you use \be or \blur along with a border, and why the fill does blur when you use blur on lines with no border: The fill bitmap is rendered on top of the blurred border, even though the border blur extends below the fill.</p></article></div></div></div></div><footer class="footer text-muted"><div class=container-fluid><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a class=text-muted href=https://gohugo.io/>Hugo</a> and <a class=text-muted href=https://getdoks.org/>Doks</a>.<br>Copyright (c) AegiSite <a href=https://github.com/Aegisub/aegisite/graphs/contributors>contributors</a>.</li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline><li class=list-inline-item><a href=/privacy-policy/>Privacy</a></li></ul></div></div></div></footer><script src=/js/bootstrap.min.44fc78ffe68ed681865871fdec9750ca44c6febe429bf0779d114896edde0f92b92891b983ef933484a02a2c7ceb3d1fa6392c39179350ad04197a153a2db970.js integrity="sha512-RPx4/+aO1oGGWHH97JdQykTG/r5Cm/B3nRFIlu3eD5K5KJG5g++TNISgKix86z0fpjksOReTUK0EGXoVOi25cA==" crossorigin=anonymous defer></script>
<script src=/js/highlight.min.ce39cca46643b8f4ca5d8866112a6450f305ee8373d516503859173f9f0bed10e50403f8e8b63fb61e2248e547d92ff356a1a02eb7a955bcedffff00ac246b98.js integrity="sha512-zjnMpGZDuPTKXYhmESpkUPMF7oNz1RZQOFkXP58L7RDlBAP46LY/th4iSOVH2S/zVqGgLrepVbzt//8ArCRrmA==" crossorigin=anonymous defer></script>
<script src=/main.min.6d71fbd7868b6ed79f4e266aadfd0e94c006f97b21de27e04869fe4dcf98156ca1fb76198518804387a7510f7ccb824cf48516b1fa9ce71d3c7f18b77a5f9005.js integrity="sha512-bXH714aLbtefTiZqrf0OlMAG+Xsh3ifgSGn+Tc+YFWyh+3YZhRiAQ4enUQ98y4JM9IUWsfqc5x08fxi3el+QBQ==" crossorigin=anonymous defer></script></body></html>