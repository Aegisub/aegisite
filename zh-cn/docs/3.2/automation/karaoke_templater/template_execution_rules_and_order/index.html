<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://aegisub.github.io/aegisite/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://aegisub.github.io/aegisite/fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://aegisub.github.io/aegisite/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><script>(()=>{var b=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,a=localStorage.getItem("theme");b&&a===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),b&&a==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),a==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=https://aegisub.github.io/aegisite/main.a069f92f6400c25f9338ec05c5dc67c53682e49a491b3de5e090ded9a734d8fbd5e61c73163c250c0406bf70bcbbc85a2d3b625a7123172a8c4dc9e35b243c51.css integrity="sha512-oGn5L2QAwl+TOOwFxdxnxTaC5JpJGz3l4JDe2ac02PvV5hxzFjwlDAQGv3C8u8haLTtiWnEjFyqMTcnjWyQ8UQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>卡拉OK模板执行环境和顺序 - Aegisub</title><meta name=description content="本页描述了许多有关 卡拉OK模板执行器(kara-templater) 的工作方式，并且会解释为什么许多东西起作用，而另一些不起作用。
大多数的细节你在卡拉OK模板执行器中是不需要用到的，但是如果你在某些脚本中看到了你不理解的行为，那么本页面可能会解释它。
概念 # 有些术语和概念在本页全篇中都有使用。这些名称和脚本中使用的相似或者完全相同。（译者注：在使用时需要保留英文，故翻译内容保留重要英文）
 tenv template environment(模板环境)的缩写, 或者 代码执行环境。 varctx variable context(内联变量环境), 内联变量存储在的实际区域。 template 卡拉OK模板执行器(kara-templater)中最基本的 &amp;ldquo;执行单元(execution unit)&amp;rdquo; , 事实上一个模板就是一个迷你程序，这个程序由 卡拉OK模板执行器 编译并执行。 code template 以Lua代码块方式行使功能的模板，但是一般情况下不会直接输出字幕对象。(用 code 关键字声明) output template 会产生字幕行(字幕对象)的一类模板，一般以打好K值的行作为输入。(用 template 关键字声明) code line 字幕文件中的一行，该行定义了一个code模板(code 模板)。 template line 字幕文件中的一行，该行定义了一个输出模板(output template), 或者整个输出模板中的一部分。 (一个 line 类输出模板可以对应多个模板行) class(类) 一个类指的是一种类型的模板。有四种基本的模板类, once, line, syl and furi, 第一个类只对code模板有用。 modifier(修饰语) 修饰语会影响模板作用的方式和作用的顺序。 template text 或 text 模板的&amp;quot;文本&amp;quot; 部分，可以是code模板中的 Lua 代码，或者是输出模板中的模板代码。 line 类输出模板还有一个 pre-line text 。  启动(Start-up) # 卡拉OK模板执行器(后文均简称模板应用器)做的第一件事是使用 卡拉OK框架(karaskel) 来收集一些基础的字幕文件信息。这个过程中总是会伴随着传递 真(true)值给 generate_furigana (生成假名标注)，它属于karaskel."><link rel=canonical href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/template_execution_rules_and_order/><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="og:title" content="卡拉OK模板执行环境和顺序"><meta property="og:description" content="本页描述了许多有关 卡拉OK模板执行器(kara-templater) 的工作方式，并且会解释为什么许多东西起作用，而另一些不起作用。
大多数的细节你在卡拉OK模板执行器中是不需要用到的，但是如果你在某些脚本中看到了你不理解的行为，那么本页面可能会解释它。
概念 # 有些术语和概念在本页全篇中都有使用。这些名称和脚本中使用的相似或者完全相同。（译者注：在使用时需要保留英文，故翻译内容保留重要英文）
 tenv template environment(模板环境)的缩写, 或者 代码执行环境。 varctx variable context(内联变量环境), 内联变量存储在的实际区域。 template 卡拉OK模板执行器(kara-templater)中最基本的 &ldquo;执行单元(execution unit)&rdquo; , 事实上一个模板就是一个迷你程序，这个程序由 卡拉OK模板执行器 编译并执行。 code template 以Lua代码块方式行使功能的模板，但是一般情况下不会直接输出字幕对象。(用 code 关键字声明) output template 会产生字幕行(字幕对象)的一类模板，一般以打好K值的行作为输入。(用 template 关键字声明) code line 字幕文件中的一行，该行定义了一个code模板(code 模板)。 template line 字幕文件中的一行，该行定义了一个输出模板(output template), 或者整个输出模板中的一部分。 (一个 line 类输出模板可以对应多个模板行) class(类) 一个类指的是一种类型的模板。有四种基本的模板类, once, line, syl and furi, 第一个类只对code模板有用。 modifier(修饰语) 修饰语会影响模板作用的方式和作用的顺序。 template text 或 text 模板的&#34;文本&#34; 部分，可以是code模板中的 Lua 代码，或者是输出模板中的模板代码。 line 类输出模板还有一个 pre-line text 。  启动(Start-up) # 卡拉OK模板执行器(后文均简称模板应用器)做的第一件事是使用 卡拉OK框架(karaskel) 来收集一些基础的字幕文件信息。这个过程中总是会伴随着传递 真(true)值给 generate_furigana (生成假名标注)，它属于karaskel."><meta property="og:url" content="https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/template_execution_rules_and_order/"><meta property="og:site_name" content="Aegisub"><meta property="og:image" content="https://aegisub.github.io/aegisite/img/logo.png"><meta property="og:image:alt" content="Aegisub"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@aegisub"><meta name=twitter:creator content><meta name=twitter:title content="卡拉OK模板执行环境和顺序"><meta name=twitter:description content><meta name=twitter:image content="https://aegisub.github.io/aegisite/img/logo.png"><meta name=twitter:image:alt content="卡拉OK模板执行环境和顺序"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://aegisub.github.io/#/schema/organization/1","name":"Aegisub","url":"https://aegisub.github.io/","sameAs":["https://twitter.com/aegisub","https://github.com/Aegisub/Aegisub"],"logo":{"@type":"ImageObject","@id":"https://aegisub.github.io/#/schema/image/1","url":"https://aegisub.github.io/logo-aegisub.png","width":512,"height":512,"caption":"Aegisub"},"image":{"@id":"https://aegisub.github.io/#/schema/image/1"}},{"@type":"WebSite","@id":"https://aegisub.github.io/#/schema/website/1","url":"https://aegisub.github.io/","name":"Aegisub","description":"Aegisub 是一款自由、跨平台的开源字幕编辑软件。 它能让您轻松且高效地完成时间轴的制作， 并利用内置的各种实用工具来调整字幕的样式， 还可以进行实时的视频预览。","publisher":{"@id":"https://aegisub.github.io/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/template_execution_rules_and_order/","url":"https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/template_execution_rules_and_order/","name":"卡拉OK模板执行环境和顺序","description":"","isPartOf":{"@id":"https://aegisub.github.io/#/schema/website/1"},"about":{"@id":"https://aegisub.github.io/#/schema/organization/1"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"0001-01-01T00:00:00CET","breadcrumb":{"@id":"https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/template_execution_rules_and_order/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/template_execution_rules_and_order/#/schema/image/2"},"inLanguage":"zh_CN","potentialAction":[{"@type":"ReadAction","target":["https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/template_execution_rules_and_order/"]}]},{"@type":"BreadcrumbList","@id":"https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/template_execution_rules_and_order/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://aegisub.github.io/aegisite/","url":"https://aegisub.github.io/aegisite/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://aegisub.github.io/aegisite/zh-cn/","url":"https://aegisub.github.io/aegisite/zh-cn/","name":"Zh Cn"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://aegisub.github.io/aegisite/zh-cn/docs/","url":"https://aegisub.github.io/aegisite/zh-cn/docs/","name":"Docs"}},{"@type":"ListItem","position":4,"item":{"@type":"WebPage","@id":"https://aegisub.github.io/aegisite/zh-cn/docs/3.2/","url":"https://aegisub.github.io/aegisite/zh-cn/docs/3.2/","name":"3.2"}},{"@type":"ListItem","position":5,"item":{"@type":"WebPage","@id":"https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/","url":"https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/","name":"Automation"}},{"@type":"ListItem","position":6,"item":{"@type":"WebPage","@id":"https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/","url":"https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/","name":"Karaoke Templater"}},{"@type":"ListItem","position":7,"item":{"@id":"https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/template_execution_rules_and_order/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://aegisub.github.io/#/schema/article/1","headline":"卡拉OK模板执行环境和顺序","description":"","isPartOf":{"@id":"https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/template_execution_rules_and_order/"},"mainEntityOfPage":{"@id":"https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/template_execution_rules_and_order/"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"0001-01-01T00:00:00CET","author":{"@id":"https://aegisub.github.io/#/schema/person/2"},"publisher":{"@id":"https://aegisub.github.io/#/schema/organization/1"},"image":{"@id":"https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/template_execution_rules_and_order/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://aegisub.github.io/#/schema/person/2","name":null,"sameAs":[]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/template_execution_rules_and_order/#/schema/image/2","url":"https://aegisub.github.io/aegisite/img/logo.png","contentUrl":"https://aegisub.github.io/aegisite/img/logo.png","caption":"卡拉OK模板执行环境和顺序"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://aegisub.github.io/aegisite/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://aegisub.github.io/aegisite/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://aegisub.github.io/aegisite/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://aegisub.github.io/aegisite/site.webmanifest></head><body class="docs single"><div class=sticky-lg-top><div class=header-bar></div><header class="navbar navbar-expand-md navbar-light doks-navbar"><nav class="container-fluid flex-wrap flex-md-nowrap" aria-label="Main navigation"><a class="navbar-brand p-0 me-auto" href=https://aegisub.github.io/aegisite/zh-cn/ aria-label=Aegisub>Aegisub</a>
<button class="btn btn-menu d-block d-md-none order-5" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-start border-0 py-md-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-md-none"></div><div class="offcanvas-header d-md-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=https://aegisub.github.io/aegisite/zh-cn/>Aegisub</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body px-4"><h3 class="h6 text-uppercase mb-3 d-md-none">Main</h3><ul class="nav flex-column flex-md-row ms-md-n3"><li class=nav-item><a class="nav-link ps-0 py-1" href=https://aegisub.github.io/aegisite/zh-cn/downloads/main/>下载</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://aegisub.github.io/aegisite/zh-cn/docs/>文档</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://github.com/Aegisub/Aegisub/issues>Bug 追踪</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://aegisub.github.io/aegisite/zh-cn/blog/>Blog</a></li></ul><hr class="text-black-50 my-4 d-md-none"><h3 class="h6 text-uppercase mb-3 d-md-none">Socials</h3><ul class="nav flex-column flex-md-row ms-md-auto me-md-n5 pe-md-2"><li class=nav-item><a class="nav-link ps-0 py-1" href=https://github.com/Aegisub/Aegisub><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-md-none">GitHub</small></a></li></ul></div></div><button id=mode class="btn btn-link order-md-1" type=button aria-label="Toggle user interface mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><div class="dropdown order-md-2"><button class="btn btn-doks-light dropdown-toggle" id=doks-languages data-bs-toggle=dropdown aria-expanded=false data-bs-display=static>
ZH
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></button><ul class="dropdown-menu dropdown-menu-end shadow rounded border-0" aria-labelledby=doks-languages><li><a class="dropdown-item current" aria-current=true href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/template_execution_rules_and_order/>简体中文</a></li><li><hr class=dropdown-divider></li><li><a class=dropdown-item rel=alternate href=https://aegisub.github.io/aegisite/docs/3.2/automation/karaoke_templater/template_execution_rules_and_order/ hreflang=en lang=en>English</a></li></ul></div></nav></header></div><nav class="doks-subnavbar py-2 sticky-lg-top d-lg-none" aria-label="Secondary navigation"><div class="container-fluid d-flex align-items-md-center"><button class="btn doks-sidebar-toggle d-lg-none ms-3 order-3 collapsed ms-auto" type=button data-bs-toggle=collapse data-bs-target=#doks-docs-nav aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle documentation navigation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></button></div></nav><div class=container-fluid><aside class=doks-sidebar><nav id=doks-docs-nav class="collapse d-lg-none" aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-navigation aria-expanded=false>
导航</button><div class=collapse id=section-navigation><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/main_page/>主页</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-introduction aria-expanded=false>
介绍</button><div class=collapse id=section-introduction><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/about/>Aegisub 是什么？</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/overview/>概述</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/highlights/>亮点</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/credits/>贡献者</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/aegisub_manual/general_disclaimer/>General Disclaimer</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/support/>支持 Aegisub</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/faq/>FAQ</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-tutorials aria-expanded=false>
教程</button><div class=collapse id=section-tutorials><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/tutorials/>Overview</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/karaoke_timing_tutorial/>卡拉OK计时</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/karaoke_inline-fx/>卡拉OK内联特效</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/furigana_karaoke/>注音卡拉OK</a></li></ul></div></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-working-with-subtitles aria-expanded=false>
制作字幕</button><div class=collapse id=section-working-with-subtitles><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/editing_subtitles/>编辑字幕</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/exporting/>导出字幕</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/attaching_subtitles_to_video/>将字幕加到视频上</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/spell_checker/>拼写检查器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/translation_assistant/>翻译助手</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/paste_over/>选择性粘贴</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/select_lines/>选择多行</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-typesetting aria-expanded=false>
排版</button><div class=collapse id=section-typesetting><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/typesetting/>介绍</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/video/>视频</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/styles/>样式</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/visual_typesetting/>可视化排版</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/ass_tags/>ASS标签</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/colour_picker/>颜色选择器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/styling_assistant/>样式助手</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/resolution_resampler/>重设分辨率</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/fonts_collector/>字体收集器</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-timing aria-expanded=false>
时间轴</button><div class=collapse id=section-timing><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/audio/>音频</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/timing/>制作时间轴</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/shift_times/>平移时间</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/timing_post-processor/>时间后续处理器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/kanji_timer/>汉字计时器</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-automation aria-expanded=true>
自动化</button><div class="collapse show" id=section-automation><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/>自动化</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-karaoke-templater aria-expanded=true>
卡拉OK模版执行器</button><div class="collapse show" id=section-karaoke-templater><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/>Overview</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/declaring_template_and_code_lines/>声明template行和code行</a></li><li><a class="docs-link rounded active" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/template_execution_rules_and_order/>卡拉OK模板执行环境和顺序</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/template_modifiers/>模版修饰语</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/inline_variables/>内联变量</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/code_lines_and_blocks/>Code行 和 Code区</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/code_execution_environment/>Execution envirionment</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-automation-tutorials aria-expanded=false>
Automation Tutorials</button><div class=collapse id=section-automation-tutorials><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/tutorial/>Overview</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/tutorial_1/>教程一</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/tutorial_2/>教程二</a></li></ul></div></li></ul></div></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-lua-reference aria-expanded=false>
Lua 相关</button><div class=collapse id=section-lua-reference><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/>Overview</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/registration/>注册</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/subtitle_file_interface/>字幕文件接口</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/progress_reporting/>进度报告</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/dialogs/>对话框</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/miscellaneous_apis/>杂项API</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-lua-modules aria-expanded=false>
Lua模块</button><div class=collapse id=section-lua-modules><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/modules/>Overview</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/modules/karaskel.lua/>karaskel.lua</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/modules/util/>utils.lua</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/modules/unicode/>unicode.lua</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/modules/cleantags/>cleantags.lua</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/modules/clipboard/>剪贴板</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/modules/re/>re</a></li></ul></div></li></ul></div></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/manager/>自动化脚本管理器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/running_macros/>运行宏</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/included_macros/>附带的宏</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/sidebar/history_of_automation/>History of Automation</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-miscellaneous aria-expanded=false>
杂项</button><div class=collapse id=section-miscellaneous><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/options/>选项</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/autosave/>自动保存</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/aegisub_path_specifiers/>Aegisub路径变量</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/properties/>脚本配置</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/script_resolution/>脚本分辨率</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/attachment_manager/>附件管理器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/commands/>Commands</a></li></ul></div></li></ul></nav></aside></div><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-navigation aria-expanded=false>
导航</button><div class=collapse id=section-navigation><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/main_page/>主页</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-introduction aria-expanded=false>
介绍</button><div class=collapse id=section-introduction><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/about/>Aegisub 是什么？</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/overview/>概述</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/highlights/>亮点</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/credits/>贡献者</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/aegisub_manual/general_disclaimer/>General Disclaimer</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/support/>支持 Aegisub</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/faq/>FAQ</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-tutorials aria-expanded=false>
教程</button><div class=collapse id=section-tutorials><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/tutorials/>Overview</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/karaoke_timing_tutorial/>卡拉OK计时</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/karaoke_inline-fx/>卡拉OK内联特效</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/furigana_karaoke/>注音卡拉OK</a></li></ul></div></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-working-with-subtitles aria-expanded=false>
制作字幕</button><div class=collapse id=section-working-with-subtitles><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/editing_subtitles/>编辑字幕</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/exporting/>导出字幕</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/attaching_subtitles_to_video/>将字幕加到视频上</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/spell_checker/>拼写检查器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/translation_assistant/>翻译助手</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/paste_over/>选择性粘贴</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/select_lines/>选择多行</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-typesetting aria-expanded=false>
排版</button><div class=collapse id=section-typesetting><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/typesetting/>介绍</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/video/>视频</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/styles/>样式</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/visual_typesetting/>可视化排版</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/ass_tags/>ASS标签</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/colour_picker/>颜色选择器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/styling_assistant/>样式助手</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/resolution_resampler/>重设分辨率</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/fonts_collector/>字体收集器</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-timing aria-expanded=false>
时间轴</button><div class=collapse id=section-timing><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/audio/>音频</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/timing/>制作时间轴</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/shift_times/>平移时间</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/timing_post-processor/>时间后续处理器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/kanji_timer/>汉字计时器</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-automation aria-expanded=true>
自动化</button><div class="collapse show" id=section-automation><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/>自动化</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-karaoke-templater aria-expanded=true>
卡拉OK模版执行器</button><div class="collapse show" id=section-karaoke-templater><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/>Overview</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/declaring_template_and_code_lines/>声明template行和code行</a></li><li><a class="docs-link rounded active" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/template_execution_rules_and_order/>卡拉OK模板执行环境和顺序</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/template_modifiers/>模版修饰语</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/inline_variables/>内联变量</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/code_lines_and_blocks/>Code行 和 Code区</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/code_execution_environment/>Execution envirionment</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-automation-tutorials aria-expanded=false>
Automation Tutorials</button><div class=collapse id=section-automation-tutorials><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/tutorial/>Overview</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/tutorial_1/>教程一</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/tutorial_2/>教程二</a></li></ul></div></li></ul></div></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-lua-reference aria-expanded=false>
Lua 相关</button><div class=collapse id=section-lua-reference><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/>Overview</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/registration/>注册</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/subtitle_file_interface/>字幕文件接口</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/progress_reporting/>进度报告</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/dialogs/>对话框</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/miscellaneous_apis/>杂项API</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-lua-modules aria-expanded=false>
Lua模块</button><div class=collapse id=section-lua-modules><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/modules/>Overview</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/modules/karaskel.lua/>karaskel.lua</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/modules/util/>utils.lua</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/modules/unicode/>unicode.lua</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/modules/cleantags/>cleantags.lua</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/modules/clipboard/>剪贴板</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/modules/re/>re</a></li></ul></div></li></ul></div></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/manager/>自动化脚本管理器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/running_macros/>运行宏</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/included_macros/>附带的宏</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/sidebar/history_of_automation/>History of Automation</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-miscellaneous aria-expanded=false>
杂项</button><div class=collapse id=section-miscellaneous><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/options/>选项</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/autosave/>自动保存</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/aegisub_path_specifiers/>Aegisub路径变量</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/properties/>脚本配置</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/script_resolution/>脚本分辨率</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/attachment_manager/>附件管理器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/commands/>Commands</a></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#概念>概念</a></li><li><a href=#启动start-up>启动(Start-up)</a><ul><li><a href=#收集解析并编译模板>收集，解析并编译模板</a></li><li><a href=#清除clean-up>清除(Clean-up)</a></li><li><a href=#初始化-tenv>初始化 <em>tenv</em></a></li></ul></li><li><a href=#运行-once-模板>运行 <em>once</em> 模板</a></li><li><a href=#循环访问iterate-through卡拉ok行>循环访问(Iterate through)卡拉OK行</a><ul><li><a href=#模板匹配行>模板匹配行</a></li></ul></li><li><a href=#应用-line-类模板>应用 <em>line</em> 类模板</a></li><li><a href=#应用-syl-和-furi-类模板>应用 <em>syl</em> 和 <em>furi</em> 类模板</a></li><li><a href=#过程描述>过程描述</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>卡拉OK模板执行环境和顺序</h1><p class=lead></p><nav class=d-xl-none aria-label="Quaternary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#概念>概念</a></li><li><a href=#启动start-up>启动(Start-up)</a><ul><li><a href=#收集解析并编译模板>收集，解析并编译模板</a></li><li><a href=#清除clean-up>清除(Clean-up)</a></li><li><a href=#初始化-tenv>初始化 <em>tenv</em></a></li></ul></li><li><a href=#运行-once-模板>运行 <em>once</em> 模板</a></li><li><a href=#循环访问iterate-through卡拉ok行>循环访问(Iterate through)卡拉OK行</a><ul><li><a href=#模板匹配行>模板匹配行</a></li></ul></li><li><a href=#应用-line-类模板>应用 <em>line</em> 类模板</a></li><li><a href=#应用-syl-和-furi-类模板>应用 <em>syl</em> 和 <em>furi</em> 类模板</a></li><li><a href=#过程描述>过程描述</a></li></ul></nav></div></nav><p>本页描述了许多有关 卡拉OK模板执行器(<em>kara-templater</em>)
的工作方式，并且会解释为什么许多东西起作用，而另一些不起作用。</p><p>大多数的细节你在卡拉OK模板执行器中是不需要用到的，但是如果你在某些脚本中看到了你不理解的行为，那么本页面可能会解释它。</p><h2 id=概念>概念 <a href=#%e6%a6%82%e5%bf%b5 class=anchor aria-hidden=true>#</a></h2><p>有些术语和概念在本页全篇中都有使用。这些名称和脚本中使用的相似或者完全相同。（译者注：在使用时需要保留英文，故翻译内容保留重要英文）</p><dl><dt><code>tenv</code></dt><dd><strong>t</strong>emplate <strong>env</strong>ironment(模板环境)的缩写, 或者
<a href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/code_execution_environment/>代码执行环境</a>。</dd><dt><code>varctx</code></dt><dd><strong>var</strong>iable <strong>c</strong>on<strong>t</strong>e<strong>x</strong>t(内联变量环境),
<a href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/inline_variables/>内联变量</a>存储在的实际区域。</dd><dt><code>template</code></dt><dd>卡拉OK模板执行器(kara-templater)中最基本的 &ldquo;执行单元(execution
unit)&rdquo; , 事实上一个模板就是一个迷你程序，这个程序由
卡拉OK模板执行器 编译并执行。</dd><dt><code>code template</code></dt><dd>以Lua代码块方式行使功能的模板，但是一般情况下不会直接输出字幕对象。(用
<em>code</em> 关键字声明)</dd><dt><code>output template</code></dt><dd>会产生字幕行(字幕对象)的一类模板，一般以打好K值的行作为输入。(用
<em>template</em> 关键字声明)</dd><dt><code>code line</code></dt><dd>字幕文件中的一行，该行定义了一个code模板(code 模板)。</dd><dt><code>template line</code></dt><dd>字幕文件中的一行，该行定义了一个输出模板(output template),
或者整个输出模板中的一部分。 (一个 <em>line</em>
类输出模板可以对应多个模板行)</dd><dt><code>class(类)</code></dt><dd>一个类指的是一种类型的模板。有四种基本的模板类, <em>once</em>, <em>line</em>,
<em>syl</em> and <em>furi</em>, 第一个类只对code模板有用。</dd><dt><code>modifier(修饰语)</code></dt><dd>修饰语会影响模板作用的方式和作用的顺序。</dd><dt><code>template text</code> 或 <code>text</code></dt><dd>模板的"文本" 部分，可以是code模板中的 Lua
代码，或者是输出模板中的模板代码。 <em>line</em> 类输出模板还有一个
<em>pre-line text</em> 。</dd></dl><h2 id=启动start-up>启动(Start-up) <a href=#%e5%90%af%e5%8a%a8start-up class=anchor aria-hidden=true>#</a></h2><p>卡拉OK模板执行器(后文均简称模板应用器)做的第一件事是使用
<a href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/lua/modules/karaskel.lua/>卡拉OK框架(karaskel)</a>
来收集一些基础的字幕文件信息。这个过程中总是会伴随着传递 <code>真(true)</code>值给
<em>generate_furigana</em> (生成假名标注)，它属于<code>karaskel.collect_head</code>
函数，这意味着
[假名标注(furigana)](/zh-cn/docs/3.2/furigana_karaoke/
的样式会被生成，除非它们早就存在。</p><p>然后模板应用器会收集文件中的所有模板行(template line)信息。</p><h3 id=收集解析并编译模板>收集，解析并编译模板 <a href=#%e6%94%b6%e9%9b%86%e8%a7%a3%e6%9e%90%e5%b9%b6%e7%bc%96%e8%af%91%e6%a8%a1%e6%9d%bf class=anchor aria-hidden=true>#</a></h3><p>文件中的每一行都会被检查是否是一行模板，例如，被打上注释并且特效栏(Effect
field)填写着 <em>code</em> 或者 <em>template</em> 的行会被作为模板行。</p><p>细节在这里并不重要。你要知道的是
特效栏关键字后的修饰语会作为一个参数起作用。</p><p>当遇到一个 <em>line</em>
类的模板行时，模板应用器首先会检查是否有其他和这行具有一样模板名称的行。如果没有，则会以该名称新建一行，并按照给定的修饰语进行初始化。如果已经存在这样的行,
<em>该模板行中的文本会被加入到当前模板行中统一成一个新模板行</em>
。最终应用的修饰语决定于后一个模板行的修饰语，而非当前行。应用模板的过程中，修饰语没有办法从模板中移除。特殊的是
<em>pre-line</em> 模板行的文本会被添加到 <em>pre-line text</em>
(被置于所有代码的最前面)。</p><p>不同类的模板会被分别放置到各自的 &ldquo;bucket&rdquo; 中，所以 <em>line</em> 和 <em>syl</em>
模板不会被一起保存。(应用模板后不会产生同类合并效果)</p><h3 id=清除clean-up>清除(Clean-up) <a href=#%e6%b8%85%e9%99%a4clean-up class=anchor aria-hidden=true>#</a></h3><p>在所有模板信息都被收集后。所有不需要的行会被从字幕文件中删除，最常见的情况是，第二次应用同一个模板时第一次生成的
<em>fx(在Effect栏)</em> 行会先被清除。</p><h3 id=初始化-tenv>初始化 <em>tenv</em> <a href=#%e5%88%9d%e5%a7%8b%e5%8c%96-tenv class=anchor aria-hidden=true>#</a></h3><p>在开始实际应用模板之前的最后一项工作就是初始化运行环境。基本上，在所有的模板运行之前，都会被放置到
<em>tenv</em>。详见 <a href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/code_execution_environment/>代码执行环境</a>
(&ldquo;基本上"是指除了 <code>line</code>, <code>orgline</code>, <code>syl</code> 和 <code>basesyl</code>.)</p><h2 id=运行-once-模板>运行 <em>once</em> 模板 <a href=#%e8%bf%90%e8%a1%8c-once-%e6%a8%a1%e6%9d%bf class=anchor aria-hidden=true>#</a></h2><p>所有的 <em>once</em>
类模板会被首先执行。这个过程中没有什么激动人心的事情发生，发生的仅仅是一些额外的文件被添加到了
<em>tenv</em>。</p><h2 id=循环访问iterate-through卡拉ok行>循环访问(Iterate through)卡拉OK行 <a href=#%e5%be%aa%e7%8e%af%e8%ae%bf%e9%97%aeiterate-through%e5%8d%a1%e6%8b%89ok%e8%a1%8c class=anchor aria-hidden=true>#</a></h2><p>字幕文件中的每个非模板行都会被浏览并且按顺序应用上模板。</p><ul><li>如果一行的注释已经打勾，但是特效栏没有写着<code>Karaoke</code>，那么应用模板时这行会被跳过。</li><li>如果一行没被打上注释，并且特效栏写着除了<code>Karaoke</code>或者空白以外的文本，它也会被跳过。</li><li>模板应用器会试图匹配所有非模板行。</li></ul><p>如果通过了以上几点，剩下的每一行都会以三个步骤被应用上模板。</p><p>首先，所有的 <em>line</em>
类模板会试图匹配非模板行然后再逐一在karaoke行上运行。下面会给出"模板匹配行的顺序"的概念。</p><p>接下来，所有行内的音节会按顺序被浏览，所有的 <em>syl</em>
类模板最终会被应用在每个音节上。</p><p>最后，会过一遍所有注音假名的音节，来尝试将所有 <em>furi</em>
类模板匹配相应行，然后在注音假名上应用模板。</p><p>值得注意的是，音节和注音假名音节是会被解析并储存的音节，而不是用multi时的虚拟音节，或是用char时的虚拟音节，并且不是一个组合。</p><div class=card><strong class=card-header>Example</strong><div class=card-body><p>假设有三个 <code>syl</code> 类模板: A, B 和 C.</p><ul><li>A 是一个规则的模板，不带有 <em>multi</em> 或者 <em>char</em> 修饰语。</li><li>B 模板含有 <em>multi</em> 修饰语，但是不含有 <em>char</em> 修饰语。</li><li>C 含有 <em>char</em> 和 <em>multi</em> 修饰语。</li></ul><p>现在这三个模板会被应用到一行中，这行含有两个音节(syllable)。以下是过程:</p><ul><li>音节1 被选出<ul><li>模板A匹配到这行，音节1被匹配。<ul><li>模板A被应用到音节1。</li></ul></li><li>模板B匹配到这行，音节1被匹配。<ul><li>音节1被分解为多音节标注的虚拟音节1.1 和 1.2</li><li>模板B被应用到虚拟音节1.1。</li><li>模板B被应用到虚拟音节1.2。</li></ul></li><li>模板C匹配到这行。<ul><li>音节1被分解为以字符为单位的虚拟音节1.a 和 1.b</li><li>音节 1.a 和 1.b 被进一步分解为 1.a1, 1.a2, 1.b1 和 1.b2。</li><li>模板C被应用到虚拟音节 1.a1。</li><li>模板C被应用到虚拟音节 1.a2。</li><li>模板C被应用到虚拟音节 1.b1。</li><li>模板C被应用到虚拟音节 1.b2。</li></ul></li><li>音节2 被选出<ul><li>进行和上面相似的过程。</li></ul></li></ul></li></ul><p>想知道更多有关 多音节标注 和 以字符为单位的虚拟音节的内容，请看下面。</p></div></div><p>如果任何一个模板在以上三个步骤中匹配到了"打好K值的行&rdquo;，执行过模板后这样的行就会被打上注释，并且特效栏会显示
<code>karaoke</code> 。</p><h3 id=模板匹配行>模板匹配行 <a href=#%e6%a8%a1%e6%9d%bf%e5%8c%b9%e9%85%8d%e8%a1%8c class=anchor aria-hidden=true>#</a></h3><p>模板的匹配总是以行为单位，而不是音节或其他单位。</p><ul><li>如果模板含有 <em>fxgroup</em> 修饰语，那么名字和 fxgroup
名相同的行会被无视。</li><li>如果模板含有 <em>all</em> 修饰语，它会匹配任何行。</li><li>如果模板和某行有一样的样式，它会匹配到这行。（这是最常见的情况）</li><li>其他情况下模板不会匹配到行。</li></ul><h2 id=应用-line-类模板>应用 <em>line</em> 类模板 <a href=#%e5%ba%94%e7%94%a8-line-%e7%b1%bb%e6%a8%a1%e6%9d%bf class=anchor aria-hidden=true>#</a></h2><div class="alert alert-warning" role=alert><strong>TODO: </strong>待编写(原文如此)</div><h2 id=应用-syl-和-furi-类模板>应用 <em>syl</em> 和 <em>furi</em> 类模板 <a href=#%e5%ba%94%e7%94%a8-syl-%e5%92%8c-furi-%e7%b1%bb%e6%a8%a1%e6%9d%bf class=anchor aria-hidden=true>#</a></h2><div class="alert alert-warning" role=alert><strong>TODO: </strong>待编写(原文如此)</div><h2 id=过程描述>过程描述 <a href=#%e8%bf%87%e7%a8%8b%e6%8f%8f%e8%bf%b0 class=anchor aria-hidden=true>#</a></h2><p>(这部分内容的具体代码可以在Aegisub安装目录下的automation/autoload/kara-templater.lua中读到)</p><pre>
卡拉OK模板执行器执行的主要过程:
1. 收集头部信息
   1. 找到所有的头部信息，基本有播放分辨率（X/Y）。
   2. 找到所有的样式。
   3. 生成对应样式的假名标注样式。
2. 收集模板并删除已存在的 "fx" 行lines。
3. 初始化 tenv
   1. 添加 "string", "math" 和 "_G" 标记
   2. 添加 "tenv"自引用
   3. 添加 "retime" 函数
   4. 添加空的 "fxgroup" 表
4. 运行每一个"code once" 模板
5. 对于字幕文件中每个待处理的对话行:
   a. 如果特效栏以 "code" 或 "template"开始:
      1. 跳过行
   b. 否则:
      1. 如果特效栏不是空的，也不是 "karaoke":
         a. 跳过行
      2. 如果特效栏是空的，并且该行被打上注释:
         a. 跳过行
      3. 用karaskel(卡拉OK框架)预处理行
      4. 初始化 varctx(内联变量环境)
      5. 重置 tenv
         1. 把 "orgline" 作为输入
         2. 把 "line", "syl" 和 "basesyl" 置空
      6. 对于每个 "line" 模板:
         如果样式匹配或者作用范围是"all":
         循环过程("template.loops")多次:
         1. 置 "tenv.j" 为循环计数器
         2. a. 如果模板是 code 行:
               1. 置 "tenv.line" 为输入行
               2. 运行 code 代码
            b. 否则:
               1. 产生输出行作为输入行的副本
               2. 置 "tenv.line" t为输出行
               3. 初始化 输出行层(output line Layer)为模板层(template Layer)
               4. 初始化 输出行文本为空
               5. 如果模板含有 pre-line:
                  1. 运行 pre-line 模板
                  2. 在输出结果上附加文本
               6. a. 如果模板匹配到规则的行:
                     对于输入行中的每个音节:
                     1. 置 "tenv.syl" 为音节
                     2. 为音节更新 varctx 
                     3. 运行 line 模板
                     4. 在输出结果上附加文本
                     5. 如果未设置 "notext" :
                        a. 如果设置 "keeptags" :
                           1. 在输出文本上附上 "syl.text" 
                        b. 否则:
                           1. 在输出文本上附上 "syl.text_stripped"(剥离原标签的文本)
                  b. 否则:
                     a. 如果设置了 "keeptags" :
                        1. 在输出文本上附上 "syl.text" 
                     b. 否则
                        1. 在输出文本上附上 "syl.text_stripped"
               7. 把输出行的特效栏填上 "fx"
               8. 把输出行整合到字幕文件中
      7. 对于行中每个主要的音节:
         对于每个 "syl" 模板:
         如果样式匹配或者作用范围是"all":
         如果模板不是在一个无效的fxgroup中:
         1. 置 "tenv.syl" 为音节
         2. 为音节更新 varctx 
         3. 如果音节的inlinefx(内联特效)没有匹配到对应的模板:
            1. 跳过音节
         4. 如果模板设置了 "noblank" 并且这个音节是个空格:
            1. 跳过音节
         5. 如果模板有"char"修饰:
            1. 建立 "charsyl" 作为音节的副本
            2. 置 "tenv.basesyl"(基础音节)为当前的"tenv.syl"
            3. 置 "tenv.syl" 为"charsyl"(字符音节)
            4. 对于音节中每个 Unicode 编码的字符:
               1. 对"charsyl"计算虚拟音节数 
               2. 为"字符音节"更新 varctx  
               3. 对虚拟音节继续进行音节的处理过程 (从 5.b.7.6.)
         6. 如果模板有"multi"修饰:
            1. 建立 "hlsyl"(音节) 作为音节的副本
            2. 除非 "tenv.basesyl" 早就存在,否则置为 "hlsyl"
            3. 置 "tenv.syl" 为 "hlsyl"
            4. 对于音节上每个标记:
               1. 对"hlsyl"计算虚拟音节数
               2. 为"标记音节"更新 varctx  
               3. 对虚拟音节继续进行音节的处理过程 (从 5.b.7.7.)
         7. a. 如果模板是 code 行:
               1. 置 "tenv.line" 为输入行
               2. 运行 code 代码
            b. 否则:
               1. 置 "tenv.line" 为输入行
               2. 运行 code 代码
               循环过程("template.loops")多次:
               1. 置 "tenv.j" 为循环计数器
               2. 创建输出行
               3. 置输出行的样式为虚拟音节样式
               4. 置输出行层为模板层
               5. 置 "tenv.line" 为输出行
               6. 运行模板
               7. 置输出行文本为结果
               8. a. 如果设置了 "keeptags" :
                     1. 在输出文本上附上 "syl.text"
                  b. 如果未设置 "keeptags" :
                     1. 在输出行文本上附上 "syl.text_stripped"
                  c. 其他情况下什么都不会发生
               9. 置输出行的特效栏内容为"fx"
            10. 把输出行整合到字幕文件中
      8. 对于行中的每个假名部分:
         和音节处理方式相同 (5.b.7.)
      9. 如果有非 code 模板应用到行:
         1. 把输入行置为注释
         2. 置输入行的特效栏文本为 "karaoke"
         3. 存储修饰过的输入行到字幕文件

运行 code 行:
1. 编译行文本为 Lua 函数
2. 如果编译失败, 报告错误
3. 置已编译的函数的环境到 tenv
4. 循环过程("template.loops")多次::
   1. 置 "tenv.j" 为循环计数器
   2. 运行已编译的函数
   3. 如果发生错误，报告它

运行一行单独的模板:
1. 置结果文本为模板
2. 如果存在 varctx:
   对于结果文本中的每个属于 "$([a-zA-Z_]+)" 的字符:
   1. 将捕获到的文本转化为小写
   2. a. 如果捕获到的名称在 varctx中:
         1. 替换结果文本中的这部分为 varctx中的值
      b. 否则:
         1. 警告
         2. 保持原文本不变
3. 对于结果文本中匹配到 "!(.-)!" 的情况:
   1. 附加 "结果 " 到捕获的代码中
   2. 按照Lua函数的方式编译 捕获到的代码
   3. 如果编译失败，报告错误
   4. 置已编译的函数的环境到 tenv 中
   5. 运行已编译的函数
      a. 如果已编译的函数产生了错误:
         1. 报告错误
         2. 在结果文本中保留了匹配到的内容
      b. 否则:
         1. 用函数运行的结果替换掉匹配到的内容
</pre><div class="alert alert-warning" role=alert><strong>TODO: </strong>把这变得更合理一些？(Turn this into something more reasonable?)</div><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="docs-navigation d-flex justify-content-between"><a href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/declaring_template_and_code_lines/><div class="card my-1"><div class="card-body py-2">&larr; 声明template行和code行</div></div></a><a class=ms-auto href=https://aegisub.github.io/aegisite/zh-cn/docs/3.2/automation/karaoke_templater/template_modifiers/><div class="card my-1"><div class="card-body py-2">模版修饰语 &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container-fluid><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a class=text-muted href=https://gohugo.io/>Hugo</a> and <a class=text-muted href=https://getdoks.org/>Doks</a>.<br>Copyright (c) AegiSite <a href=https://github.com/Aegisub/aegisite/graphs/contributors>contributors</a> and <a href=https://github.com/computerfan/Chinese-aegisite/graphs/contributors>translators</a>.</li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline><li class=list-inline-item><a href=https://aegisub.github.io/aegisite/privacy-policy/>Privacy</a></li></ul></div></div></div></footer><script src=https://aegisub.github.io/aegisite/js/bootstrap.min.fdbe9b9ba88a036135318f3c721784d684ac9e3280fe282cc80d7d49f7f9c82780cd54228c1608685a230c09984300d7946fc471734d566fcebc148b65bd16db.js integrity="sha512-/b6bm6iKA2E1MY88cheE1oSsnjKA/igsyA19Sff5yCeAzVQijBYIaFojDAmYQwDXlG/EcXNNVm/OvBSLZb0W2w==" crossorigin=anonymous defer></script>
<script src=https://aegisub.github.io/aegisite/js/highlight.min.8bb6cfba442658ac8fa7d0fe8972ab0a493ada9523a7705011323e2d32fce59d7e1e2c5d07813bf6e4e9543aac7a6871be209a76fdac6f5362bd22008b2a1c9e.js integrity="sha512-i7bPukQmWKyPp9D+iXKrCkk62pUjp3BQETI+LTL85Z1+HixdB4E79uTpVDqsemhxviCadv2sb1NivSIAiyocng==" crossorigin=anonymous defer></script>
<script src=https://aegisub.github.io/aegisite/main.min.9504b415386e94873638d6424009244321829335c58e8217ed1a4c776d219a4df944204093fd9024a02923b96849f0d622ce7e8cd994778575d2b7643920e34e.js integrity="sha512-lQS0FThulIc2ONZCQAkkQyGCkzXFjoIX7RpMd20hmk35RCBAk/2QJKApI7loSfDWIs5+jNmUd4V10rdkOSDjTg==" crossorigin=anonymous defer></script></body></html>