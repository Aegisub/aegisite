<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://aegisub.github.io/aegisite/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://aegisub.github.io/aegisite/fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://aegisub.github.io/aegisite/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=https://aegisub.github.io/aegisite/main.9979e0ffd73ff24a57d2d6ccbf74fd8e4d167353c7e8c4f17a77c321777141d2c09329ceba6ba5cfe0be06bf4026cd37745ba1cc14668401b6a15b9239139d7e.css integrity="sha512-mXng/9c/8kpX0tbMv3T9jk0Wc1PH6MTxenfDIXdxQdLAkynOumulz+C+Br9AJs03dFuhzBRmhAG2oVuSOROdfg==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}.collapse:not(.show){display:block}button.btn-toggle{cursor:unset}button.btn-toggle::before{display:none}.doks-subnavbar{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>karaskel.lua - Aegisub</title><meta name=description content="Automation 4的核心文件 karaskel.lua 内置了许多函数，用来协助Automation 4 Lua方面的卡拉OK特效制作 它定义了几种新的数据结构，也拓展了Automation 4 本身定义的一些。
karaskel.lua 包含 utils.lua 和 unicode.lua 。所以你在使用karaskel.lua时不必再单独include这两项。
karaskel.lua 的用武之地主要是卡拉OK特效，它也可以被用来进行一些简单的文字样式调整。
函数 # karaskel.collect_head # 摘要: meta, styles = karaskel.collect_head(subtitles, generate_furigana)
读取字幕文件来获取所有的头部信息和样式定义,也可以为假名生成新的样式。
 subtitles 指的是Automation 4 Lua定义的字幕文件对象。 generate_furigana 是在这种逻辑下进行的操作: 它会为没有对应 假名布局 的样式单独生成样式。生成的假名样式永远也不会覆盖存在的样式。  使用 collect_head 一般情况下是你在处理函数中做的第一步。
返回的 meta 表包含着以下全部， Name: Value 对应到 [Script Info] 部分。它也包含 meta.res_x 和 meta.res_y ,它们对应到 PlayResX and PlayResY 。
返回的 styles 表包含着全部已定义的样式, 也包含着自动生成的假名样式, 样式结构在style表中占有单独的位置,如style.margin_v (又称 style.margin_t), 为了方便, styles 可以通过样式名称 (区分大小写,不可缺内容) 和数字来指定。 styles."><link rel=canonical href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/karaskel.lua/><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="og:title" content="karaskel.lua"><meta property="og:description" content="Automation 4的核心文件 karaskel.lua 内置了许多函数，用来协助Automation 4 Lua方面的卡拉OK特效制作 它定义了几种新的数据结构，也拓展了Automation 4 本身定义的一些。
karaskel.lua 包含 utils.lua 和 unicode.lua 。所以你在使用karaskel.lua时不必再单独include这两项。
karaskel.lua 的用武之地主要是卡拉OK特效，它也可以被用来进行一些简单的文字样式调整。
函数 # karaskel.collect_head # 摘要: meta, styles = karaskel.collect_head(subtitles, generate_furigana)
读取字幕文件来获取所有的头部信息和样式定义,也可以为假名生成新的样式。
 subtitles 指的是Automation 4 Lua定义的字幕文件对象。 generate_furigana 是在这种逻辑下进行的操作: 它会为没有对应 假名布局 的样式单独生成样式。生成的假名样式永远也不会覆盖存在的样式。  使用 collect_head 一般情况下是你在处理函数中做的第一步。
返回的 meta 表包含着以下全部， Name: Value 对应到 [Script Info] 部分。它也包含 meta.res_x 和 meta.res_y ,它们对应到 PlayResX and PlayResY 。
返回的 styles 表包含着全部已定义的样式, 也包含着自动生成的假名样式, 样式结构在style表中占有单独的位置,如style.margin_v (又称 style.margin_t), 为了方便, styles 可以通过样式名称 (区分大小写,不可缺内容) 和数字来指定。 styles."><meta property="og:url" content="https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/karaskel.lua/"><meta property="og:site_name" content="Aegisub"><meta property="og:image" content="https://aegisub.github.io/aegisite/img/logo.png"><meta property="og:image:alt" content="Aegisub"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@aegisub"><meta name=twitter:creator content><meta name=twitter:title content="karaskel.lua"><meta name=twitter:description content><meta name=twitter:image content="https://aegisub.github.io/aegisite/img/logo.png"><meta name=twitter:image:alt content="karaskel.lua"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://aegisub.github.io/#/schema/organization/1","name":"Aegisub","url":"https://aegisub.github.io/","sameAs":["https://twitter.com/aegisub","https://github.com/Aegisub/Aegisub"],"logo":{"@type":"ImageObject","@id":"https://aegisub.github.io/#/schema/image/1","url":"https://aegisub.github.io/logo-aegisub.png","width":512,"height":512,"caption":"Aegisub"},"image":{"@id":"https://aegisub.github.io/#/schema/image/1"}},{"@type":"WebSite","@id":"https://aegisub.github.io/#/schema/website/1","url":"https://aegisub.github.io/","name":"Aegisub","description":"Aegisub 是一款自由、跨平台的开源字幕编辑软件。 它能让您轻松且高效地完成时间轴的制作， 并利用内置的各种实用工具来调整字幕的样式， 还可以进行实时的视频预览。","publisher":{"@id":"https://aegisub.github.io/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/karaskel.lua/","url":"https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/karaskel.lua/","name":"karaskel.lua","description":"","isPartOf":{"@id":"https://aegisub.github.io/#/schema/website/1"},"about":{"@id":"https://aegisub.github.io/#/schema/organization/1"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"0001-01-01T00:00:00CET","breadcrumb":{"@id":"https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/karaskel.lua/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/karaskel.lua/#/schema/image/2"},"inLanguage":"zh_CN","potentialAction":[{"@type":"ReadAction","target":["https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/karaskel.lua/"]}]},{"@type":"BreadcrumbList","@id":"https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/karaskel.lua/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://aegisub.github.io/aegisite/","url":"https://aegisub.github.io/aegisite/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://aegisub.github.io/aegisite/zh-cn/","url":"https://aegisub.github.io/aegisite/zh-cn/","name":"Zh Cn"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://aegisub.github.io/aegisite/zh-cn/docs/","url":"https://aegisub.github.io/aegisite/zh-cn/docs/","name":"Docs"}},{"@type":"ListItem","position":4,"item":{"@type":"WebPage","@id":"https://aegisub.github.io/aegisite/zh-cn/docs/latest/","url":"https://aegisub.github.io/aegisite/zh-cn/docs/latest/","name":"Latest"}},{"@type":"ListItem","position":5,"item":{"@type":"WebPage","@id":"https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/","url":"https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/","name":"Automation"}},{"@type":"ListItem","position":6,"item":{"@type":"WebPage","@id":"https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/","url":"https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/","name":"Lua"}},{"@type":"ListItem","position":7,"item":{"@type":"WebPage","@id":"https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/","url":"https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/","name":"Modules"}},{"@type":"ListItem","position":8,"item":{"@id":"https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/karaskel.lua/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://aegisub.github.io/#/schema/article/1","headline":"karaskel.lua","description":"","isPartOf":{"@id":"https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/karaskel.lua/"},"mainEntityOfPage":{"@id":"https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/karaskel.lua/"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"0001-01-01T00:00:00CET","author":{"@id":"https://aegisub.github.io/#/schema/person/2"},"publisher":{"@id":"https://aegisub.github.io/#/schema/organization/1"},"image":{"@id":"https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/karaskel.lua/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://aegisub.github.io/#/schema/person/2","name":null,"sameAs":[]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/karaskel.lua/#/schema/image/2","url":"https://aegisub.github.io/aegisite/img/logo.png","contentUrl":"https://aegisub.github.io/aegisite/img/logo.png","caption":"karaskel.lua"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://aegisub.github.io/aegisite/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://aegisub.github.io/aegisite/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://aegisub.github.io/aegisite/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://aegisub.github.io/aegisite/site.webmanifest></head><body class="docs single"><div class=sticky-lg-top><div class=header-bar></div><header class="navbar navbar-expand-md navbar-light doks-navbar"><nav class="container-fluid flex-wrap flex-md-nowrap" aria-label="Main navigation"><a class="navbar-brand p-0 me-auto" href=https://aegisub.github.io/aegisite/zh-cn/ aria-label=Aegisub>Aegisub</a>
<button class="btn btn-menu d-block d-md-none order-5" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-md-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-md-none"></div><div class="offcanvas-header d-md-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=https://aegisub.github.io/aegisite/zh-cn/>Aegisub</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body px-4"><h3 class="h6 text-uppercase mb-3 d-md-none">Main</h3><ul class="nav flex-column flex-md-row ms-md-n3"><li class=nav-item><a class="nav-link ps-0 py-1" href=https://aegisub.github.io/aegisite/zh-cn/downloads/main/>下载</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://aegisub.github.io/aegisite/zh-cn/docs/>文档</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://github.com/Aegisub/Aegisub/issues>Bug 追踪</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://aegisub.github.io/aegisite/blog/>Blog</a></li></ul><hr class="text-black-50 my-4 d-md-none"><h3 class="h6 text-uppercase mb-3 d-md-none">Socials</h3><ul class="nav flex-column flex-md-row ms-md-auto me-md-n5 pe-md-2"><li class=nav-item><a class="nav-link ps-0 py-1" href=https://github.com/Aegisub/Aegisub aria-label="View repository on GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-md-none">GitHub</small></a></li></ul></div></div><button id=mode class="btn btn-link order-md-1" type=button aria-label="Toggle user interface mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><div class="dropdown order-md-2"><button class="btn btn-doks-light dropdown-toggle" id=doks-languages data-bs-toggle=dropdown aria-expanded=false data-bs-display=static>
ZH
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></button><ul class="dropdown-menu dropdown-menu-end shadow rounded border-0" aria-labelledby=doks-languages><li><a class="dropdown-item current" aria-current=true href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/karaskel.lua/>简体中文</a></li><li><hr class=dropdown-divider></li><li><a class=dropdown-item rel=alternate href=https://aegisub.github.io/aegisite/docs/latest/automation/lua/modules/karaskel.lua/ hreflang=en lang=en>English</a></li></ul></div></nav></header></div><nav class="doks-subnavbar py-2 sticky-lg-top d-lg-none" aria-label="Secondary navigation"><div class="container-fluid d-flex align-items-md-center"><button class="btn doks-sidebar-toggle d-lg-none ms-3 order-3 collapsed ms-auto" type=button data-bs-toggle=collapse data-bs-target=#doks-docs-nav aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle documentation navigation">Docs Navigation<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></button></div></nav><div class=container-fluid><aside class=doks-sidebar><nav id=doks-docs-nav class="collapse d-lg-none" aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-navigation aria-expanded=false>
导航</button><div class=collapse id=section-navigation><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/main_page/>主页</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-introduction aria-expanded=false>
介绍</button><div class=collapse id=section-introduction><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/about/>Aegisub 是什么？</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/overview/>概述</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/highlights/>亮点</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/credits/>贡献者</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/general_disclaimer/>General Disclaimer</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/support/>支持 Aegisub</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/faq/>FAQ</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-tutorials aria-expanded=false>
教程</button><div class=collapse id=section-tutorials><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/tutorials/>Overview</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/karaoke_timing_tutorial/>卡拉OK计时</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/karaoke_inline-fx/>卡拉OK内联特效</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/furigana_karaoke/>注音卡拉OK</a></li></ul></div></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-working-with-subtitles aria-expanded=false>
制作字幕</button><div class=collapse id=section-working-with-subtitles><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/editing_subtitles/>编辑字幕</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/exporting/>导出字幕</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/attaching_subtitles_to_video/>将字幕加到视频上</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/spell_checker/>拼写检查器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/translation_assistant/>翻译助手</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/paste_over/>选择性粘贴</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/select_lines/>选择多行</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-typesetting aria-expanded=false>
排版</button><div class=collapse id=section-typesetting><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/typesetting/>介绍</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/video/>视频</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/styles/>样式</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/visual_typesetting/>可视化排版</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/ass_tags/>ASS标签</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/colour_picker/>颜色选择器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/styling_assistant/>样式助手</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/resolution_resampler/>重设分辨率</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/fonts_collector/>字体收集器</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-timing aria-expanded=false>
时间轴</button><div class=collapse id=section-timing><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/audio/>音频</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/timing/>制作时间轴</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/shift_times/>平移时间</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/timing_post-processor/>时间后续处理器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/kanji_timer/>汉字计时器</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-automation aria-expanded=true>
自动化</button><div class="collapse show" id=section-automation><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/>自动化</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-karaoke-templater aria-expanded=false>
卡拉OK模版执行器</button><div class=collapse id=section-karaoke-templater><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/>Overview</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/declaring_template_and_code_lines/>声明template行和code行</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/template_execution_rules_and_order/>卡拉OK模板执行环境和顺序</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/template_modifiers/>模版修饰语</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/inline_variables/>内联变量</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/code_lines_and_blocks/>Code行 和 Code区</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/code_execution_environment/>Execution envirionment</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-automation-tutorials aria-expanded=false>
Automation Tutorials</button><div class=collapse id=section-automation-tutorials><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/tutorial/>Overview</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/tutorial_1/>教程一</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/tutorial_2/>教程二</a></li></ul></div></li></ul></div></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-lua-reference aria-expanded=true>
Lua 相关</button><div class="collapse show" id=section-lua-reference><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/>Overview</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/registration/>注册</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/subtitle_file_interface/>字幕文件接口</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/progress_reporting/>进度报告</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/dialogs/>对话框</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/miscellaneous_apis/>杂项API</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-lua-modules aria-expanded=true>
Lua模块</button><div class="collapse show" id=section-lua-modules><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/>Overview</a></li><li><a class="docs-link rounded active" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/karaskel.lua/>karaskel.lua</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/util/>utils.lua</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/unicode/>unicode.lua</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/cleantags/>cleantags.lua</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/clipboard/>剪贴板</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/re/>re</a></li></ul></div></li></ul></div></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/manager/>自动化脚本管理器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/running_macros/>运行宏</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/included_macros/>附带的宏</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/history_of_automation/>History of Automation</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-miscellaneous aria-expanded=false>
杂项</button><div class=collapse id=section-miscellaneous><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/options/>选项</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/autosave/>自动保存</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/aegisub_path_specifiers/>Aegisub路径变量</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/properties/>脚本配置</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/script_resolution/>脚本分辨率</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/attachment_manager/>附件管理器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/commands/>Commands</a></li></ul></div></li></ul></nav></aside></div><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-navigation aria-expanded=false>
导航</button><div class=collapse id=section-navigation><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/main_page/>主页</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-introduction aria-expanded=false>
介绍</button><div class=collapse id=section-introduction><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/about/>Aegisub 是什么？</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/overview/>概述</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/highlights/>亮点</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/credits/>贡献者</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/general_disclaimer/>General Disclaimer</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/support/>支持 Aegisub</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/faq/>FAQ</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-tutorials aria-expanded=false>
教程</button><div class=collapse id=section-tutorials><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/tutorials/>Overview</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/karaoke_timing_tutorial/>卡拉OK计时</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/karaoke_inline-fx/>卡拉OK内联特效</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/furigana_karaoke/>注音卡拉OK</a></li></ul></div></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-working-with-subtitles aria-expanded=false>
制作字幕</button><div class=collapse id=section-working-with-subtitles><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/editing_subtitles/>编辑字幕</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/exporting/>导出字幕</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/attaching_subtitles_to_video/>将字幕加到视频上</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/spell_checker/>拼写检查器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/translation_assistant/>翻译助手</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/paste_over/>选择性粘贴</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/select_lines/>选择多行</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-typesetting aria-expanded=false>
排版</button><div class=collapse id=section-typesetting><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/typesetting/>介绍</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/video/>视频</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/styles/>样式</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/visual_typesetting/>可视化排版</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/ass_tags/>ASS标签</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/colour_picker/>颜色选择器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/styling_assistant/>样式助手</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/resolution_resampler/>重设分辨率</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/fonts_collector/>字体收集器</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-timing aria-expanded=false>
时间轴</button><div class=collapse id=section-timing><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/audio/>音频</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/timing/>制作时间轴</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/shift_times/>平移时间</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/timing_post-processor/>时间后续处理器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/kanji_timer/>汉字计时器</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-automation aria-expanded=true>
自动化</button><div class="collapse show" id=section-automation><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/>自动化</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-karaoke-templater aria-expanded=false>
卡拉OK模版执行器</button><div class=collapse id=section-karaoke-templater><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/>Overview</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/declaring_template_and_code_lines/>声明template行和code行</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/template_execution_rules_and_order/>卡拉OK模板执行环境和顺序</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/template_modifiers/>模版修饰语</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/inline_variables/>内联变量</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/code_lines_and_blocks/>Code行 和 Code区</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/code_execution_environment/>Execution envirionment</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-automation-tutorials aria-expanded=false>
Automation Tutorials</button><div class=collapse id=section-automation-tutorials><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/tutorial/>Overview</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/tutorial_1/>教程一</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/karaoke_templater/tutorial_2/>教程二</a></li></ul></div></li></ul></div></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-lua-reference aria-expanded=true>
Lua 相关</button><div class="collapse show" id=section-lua-reference><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/>Overview</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/registration/>注册</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/subtitle_file_interface/>字幕文件接口</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/progress_reporting/>进度报告</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/dialogs/>对话框</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/miscellaneous_apis/>杂项API</a></li><li class="my-1 ms-3"><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-lua-modules aria-expanded=true>
Lua模块</button><div class="collapse show" id=section-lua-modules><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/>Overview</a></li><li><a class="docs-link rounded active" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/karaskel.lua/>karaskel.lua</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/util/>utils.lua</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/unicode/>unicode.lua</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/cleantags/>cleantags.lua</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/clipboard/>剪贴板</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/re/>re</a></li></ul></div></li></ul></div></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/manager/>自动化脚本管理器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/running_macros/>运行宏</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/included_macros/>附带的宏</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/history_of_automation/>History of Automation</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-miscellaneous aria-expanded=false>
杂项</button><div class=collapse id=section-miscellaneous><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/options/>选项</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/autosave/>自动保存</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/aegisub_path_specifiers/>Aegisub路径变量</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/properties/>脚本配置</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/script_resolution/>脚本分辨率</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/attachment_manager/>附件管理器</a></li><li><a class="docs-link rounded" href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/commands/>Commands</a></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#函数>函数</a><ul><li><a href=#karaskelcollect_head>karaskel.collect_head</a></li><li><a href=#karaskelpreproc_line预处理行>karaskel.preproc_line(预处理行)</a></li><li><a href=#karaskelpreproc_line_text预处理行文本>karaskel.preproc_line_text(预处理行文本)</a></li><li><a href=#karaskelpreproc_line_size预处理行尺寸>karaskel.preproc_line_size(预处理行尺寸)</a></li><li><a href=#karaskelpreproc_line_pos预处理行位置>karaskel.preproc_line_pos(预处理行位置)</a></li><li><a href=#karaskeldo_basic_layout基本布局>karaskel.do_basic_layout(基本布局)</a></li><li><a href=#karaskeldo_furigana_layout假名标注布局>karaskel.do_furigana_layout(假名标注布局)</a></li></ul></li><li><a href=#karaoke-skeletons卡拉ok框架>Karaoke skeletons(卡拉OK框架)</a><ul><li><a href=#effect-library特效库>Effect Library(特效库)</a></li><li><a href=#classic-advanced>Classic Advanced</a></li></ul></li><li><a href=#data-structures>Data structures</a><ul><li><a href=#styles-array>Styles array</a></li><li><a href=#style-table>Style table</a></li><li><a href=#dialogue-line-table>Dialogue line table</a></li><li><a href=#karaoke-and-furigana-syllable-tables>Karaoke and furigana syllable tables</a></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>karaskel.lua</h1><p class=lead></p><nav class=d-xl-none aria-label="Quaternary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#函数>函数</a><ul><li><a href=#karaskelcollect_head>karaskel.collect_head</a></li><li><a href=#karaskelpreproc_line预处理行>karaskel.preproc_line(预处理行)</a></li><li><a href=#karaskelpreproc_line_text预处理行文本>karaskel.preproc_line_text(预处理行文本)</a></li><li><a href=#karaskelpreproc_line_size预处理行尺寸>karaskel.preproc_line_size(预处理行尺寸)</a></li><li><a href=#karaskelpreproc_line_pos预处理行位置>karaskel.preproc_line_pos(预处理行位置)</a></li><li><a href=#karaskeldo_basic_layout基本布局>karaskel.do_basic_layout(基本布局)</a></li><li><a href=#karaskeldo_furigana_layout假名标注布局>karaskel.do_furigana_layout(假名标注布局)</a></li></ul></li><li><a href=#karaoke-skeletons卡拉ok框架>Karaoke skeletons(卡拉OK框架)</a><ul><li><a href=#effect-library特效库>Effect Library(特效库)</a></li><li><a href=#classic-advanced>Classic Advanced</a></li></ul></li><li><a href=#data-structures>Data structures</a><ul><li><a href=#styles-array>Styles array</a></li><li><a href=#style-table>Style table</a></li><li><a href=#dialogue-line-table>Dialogue line table</a></li><li><a href=#karaoke-and-furigana-syllable-tables>Karaoke and furigana syllable tables</a></li></ul></li></ul></nav></div></nav><p>Automation 4的核心文件 <code>karaskel.lua</code> 内置了许多函数，用来协助Automation
4 Lua方面的卡拉OK特效制作 它定义了几种新的数据结构，也拓展了Automation 4
本身定义的一些。</p><p><code>karaskel.lua</code> 包含 <a href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/util/><code>utils.lua</code></a> 和
<a href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/unicode/><code>unicode.lua</code></a>
。所以你在使用<code>karaskel.lua</code>时不必再单独include这两项。</p><p><code>karaskel.lua</code>
的用武之地主要是卡拉OK特效，它也可以被用来进行一些简单的文字样式调整。</p><h2 id=函数>函数 <a href=#%e5%87%bd%e6%95%b0 class=anchor aria-hidden=true>#</a></h2><h3 id=karaskelcollect_head>karaskel.collect_head <a href=#karaskelcollect_head class=anchor aria-hidden=true>#</a></h3><p>摘要:
<code>meta, styles = karaskel.collect_head(subtitles, generate_furigana)</code></p><p>读取字幕文件来获取所有的头部信息和样式定义,也可以为假名生成新的样式。</p><ul><li><code>subtitles</code> 指的是Automation 4 Lua定义的字幕文件对象。</li><li><code>generate_furigana</code> 是在这种逻辑下进行的操作: 它会为没有对应
<a href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/furigana_karaoke/>假名布局</a>
的样式单独生成样式。生成的假名样式永远也不会覆盖存在的样式。</li></ul><p>使用 <code>collect_head</code> 一般情况下是你在处理函数中做的第一步。</p><p>返回的 <code>meta</code> 表包含着以下全部， <code>Name: Value</code> 对应到 <code>[Script Info]</code>
部分。它也包含 <code>meta.res_x</code> 和 <code>meta.res_y</code> ,它们对应到 <code>PlayResX</code> and
<code>PlayResY</code> 。</p><p>返回的 <code>styles</code> 表包含着全部已定义的样式, 也包含着自动生成的假名样式,
样式结构在style表中占有单独的位置,如<code>style.margin_v</code> (又称
<code>style.margin_t</code>), 为了方便, <code>styles</code> 可以通过样式名称
(区分大小写,不可缺内容) 和数字来指定。 <code>styles.n</code> 是样式存储的编号,
<code>styles[1]</code> 就是第一个被定义的样式。</p><h3 id=karaskelpreproc_line预处理行>karaskel.preproc_line(预处理行) <a href=#karaskelpreproc_line%e9%a2%84%e5%a4%84%e7%90%86%e8%a1%8c class=anchor aria-hidden=true>#</a></h3><p>摘要: <code>karaskel.preproc_line(subtitles, meta, styles, line)</code></p><p>为单行字幕计算尺寸、位置和其它信息。这个函数按顺序调用
<code>karaskel.preproc_line_text</code>, <code>karaskel.preproc_line_size</code> 和
<code>karaskel.preproc_line_pos</code> 。</p><p>这个函数不会返回值，但是在修饰 <code>line</code> 表的时候例外。详见下。</p><h3 id=karaskelpreproc_line_text预处理行文本>karaskel.preproc_line_text(预处理行文本) <a href=#karaskelpreproc_line_text%e9%a2%84%e5%a4%84%e7%90%86%e8%a1%8c%e6%96%87%e6%9c%ac class=anchor aria-hidden=true>#</a></h3><p>摘要: <code>karaskel.preproc_line_text(meta, styles, line)</code></p><p>预处理单行的文本。 <code>meta</code> 和 <code>styles</code> 是由
<code>[[karaskel.collect_head|karaskel.lua#karaskel.collect_head]]</code>
返回的表。</p><p>这个函数不会返回值，但是在修饰 <code>line</code> 表的时候例外:</p><ul><li><code>line.text_stripped</code> - 返回除去特效标签和绘图代码的原文本</li><li><code>line.duration</code> - 返回行的持续时间(毫秒单位)</li><li><code>line.kara</code> 和 <code>line.furi</code> - 扩展版的
<a href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/karaskel.lua/#karaoke-and-furigana-syllable-tables>卡拉OK和假名标注表</a>,
不含尺寸位置信息。</li></ul><p>这个函数不计算任何尺寸和位置信息。 (事实上它根本不使用 <code>meta</code> 或者
<code>styles</code> 之前获取到的尺寸位置信息)</p><h3 id=karaskelpreproc_line_size预处理行尺寸>karaskel.preproc_line_size(预处理行尺寸) <a href=#karaskelpreproc_line_size%e9%a2%84%e5%a4%84%e7%90%86%e8%a1%8c%e5%b0%ba%e5%af%b8 class=anchor aria-hidden=true>#</a></h3><p>摘要: <code>karaskel.preproc_line_size(meta, styles, line)</code></p><p>为整行、所有的音节和假名标注计算尺寸，参照行样式信息。</p><p>这个函数不会返回值，但是在修饰 <code>line</code> 表的时候例外:</p><ul><li><code>line.styleref</code> - 参照样式表，返回当前被应用模板的行的样式表。</li><li><code>line.furistyle</code> -
参照样式表，返回当前被应用模板的行对应假名标注的样式表。如果没有匹配的样式名称这个区域就为
<code>false</code> (假)</li><li><code>line.width</code>, <code>line.height</code>, <code>line.descent</code> 和 <code>line.extlead</code> -
原文本的尺寸信息，由
<a href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/miscellaneous_apis/#aegisub.text_extents>`aegisub.text_extents`</a>
返回。 这个函数也修饰 <code>line.kara</code> 和 <code>line.furi</code> 表, 增加尺寸信息。</li></ul><p>这一部分不涉及位置信息的计算。</p><p>如果 <code>line</code> 看起来没被 <code>karaskel.preproc_line_text</code>
处理过，那么这个步骤会自动完成。</p><h3 id=karaskelpreproc_line_pos预处理行位置>karaskel.preproc_line_pos(预处理行位置) <a href=#karaskelpreproc_line_pos%e9%a2%84%e5%a4%84%e7%90%86%e8%a1%8c%e4%bd%8d%e7%bd%ae class=anchor aria-hidden=true>#</a></h3><p>摘要: <code>karaskel.preproc_line_pos(meta, styles, line)</code></p><p>计算行、卡拉OK和假名标注的位置信息。</p><p>当没有可用的假名标注样式时，这个函数借助 <code>karaskel.do_basic_layout</code>,
当有可用的假名标注样式时借助 <code>karaskel.do_furigana_layout</code>
。假名布局算法可能改变行的计算宽度。</p><p>这个函数不会返回值，但是在修饰 <code>line</code> 表的时候例外:</p><ul><li><code>line.margin_v</code> - <code>line.margin_t</code> 的别名。</li><li><code>line.eff_margin_l</code>, <code>line.eff_margin_r</code>, <code>line.eff_margin_t</code>,
<code>line.eff_margin_b</code> 和 <code>line.eff_margin_v</code> -
该行的有效边距值。如果某一行对应的值非零，则使用这些值，否则会使用样式管理器中定义的值。</li><li><code>line.halign</code> - 三种水平对齐方式 <code>"left"</code>, <code>"center"</code> 或
<code>"right"</code>中的一种，是由 <code>line.styleref.align</code>派生出来的。</li><li><code>line.valign</code> - 三种竖直对齐方式 <code>"top"</code>, <code>"middle"</code> 或 <code>"bottom"</code>
中的一种, 是由 <code>line.styleref.align</code>派生出来的。</li><li><code>line.left</code> -
行左边缘的X坐标，假设定义了对齐，有效边距，并且未检测到重叠。</li><li><code>line.center</code> -
行水平中点的X坐标，假设定义了对齐，有效边距，并且未检测到重叠。</li><li><code>line.right</code> -
行右边缘的X坐标，假设定义了对齐，有效边距，并且未检测到重叠。</li><li><code>line.top</code> -
行上边缘的Y坐标，假设定义了对齐，有效边距，并且未检测到重叠。</li><li><code>line.middle</code> -
行竖直中点的Y坐标，假设定义了对齐，有效边距，并且未检测到重叠。别名<code>line.vcenter</code>。
<code>line.bottom</code> -
行下边缘的Y坐标，假设定义了对齐，有效边距，并且未检测到重叠。</li><li><code>line.x</code> 和 <code>line.y</code> - 行的X 和 Y 坐标，适合与 <code>\pos</code>
配合使用，保持行的原位置。</li></ul><p>此外, <code>line.kara</code> 和 <code>line.furi</code> 表是被布局函数调用，然后加上位置信息。</p><p>详见这部分 <a href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/karaskel.lua/#datastructures>data structures</a> 。</p><p>如果没有找到任何行的尺寸信息, <code>karaskel.preproc_line_size</code> 会被调用,
它可能会转而调用 <code>karaskel.preproc_line_text</code>。</p><h3 id=karaskeldo_basic_layout基本布局>karaskel.do_basic_layout(基本布局) <a href=#karaskeldo_basic_layout%e5%9f%ba%e6%9c%ac%e5%b8%83%e5%b1%80 class=anchor aria-hidden=true>#</a></h3><p>这个函数不是被直接调用的，它更像是一个 <code>karaskel.preproc_line_pos</code>
的辅助函数。</p><p>它为 <code>line.kara</code>
表运行一个简单的布局算法，简单地计算一行中各个音节的位置。位置信息被添加到各个音节。</p><p><code>line.furi</code> 表在这个函数中不被处理。</p><h3 id=karaskeldo_furigana_layout假名标注布局>karaskel.do_furigana_layout(假名标注布局) <a href=#karaskeldo_furigana_layout%e5%81%87%e5%90%8d%e6%a0%87%e6%b3%a8%e5%b8%83%e5%b1%80 class=anchor aria-hidden=true>#</a></h3><p>这个函数也不是被直接调用的，它更像是一个 <code>karaskel.preproc_line_pos</code>
的辅助函数。</p><p>它为运行一个高级的布局算法，来把卡拉OK音节和假名标注整齐地排布，还能防止重叠。对这部分使用的算法感兴趣的人可以读读源码。</p><p>这个函数为 <code>line.kara</code> 和 <code>line.furi</code> 表添加位置信息。它也有可能改变
<code>line.width</code> ，因为行宽度可能受假名标注影响而变化。</p><h2 id=karaoke-skeletons卡拉ok框架>Karaoke skeletons(卡拉OK框架) <a href=#karaoke-skeletons%e5%8d%a1%e6%8b%89ok%e6%a1%86%e6%9e%b6 class=anchor aria-hidden=true>#</a></h2><p>卡拉OK框架是指帮助你构筑卡拉OK特效的一套框架。你可以在一些自定义函数中使用它，来解决特定的特效问题，框架中的内容会多次被调用。你具体需要写什么样的函数也取决于卡拉OK框架。</p><h3 id=effect-library特效库>Effect Library(特效库) <a href=#effect-library%e7%89%b9%e6%95%88%e5%ba%93 class=anchor aria-hidden=true>#</a></h3><p>主函数: <code>karaskel.use_fx_library_furi(use_furigana, add_macro)</code></p><p>调用 <code>karaskel.use_fx_library_furi</code> 函数为当前脚本安装 特效库
框架。<code>script_name</code> 和 <code>script_description</code> 全局变量用来命名导出滤镜。
如果 <code>use_furigana</code> 为真, 则会生成专门的标注假名样式。 如果 <code>add_macro</code>
为真, 则会在导出滤镜处添加宏。</p><p>使用特效库功能的前提是在每一打好K值行的特效栏填写了你希望应用的特效类型（名称）。
如果你想在一个文件里应用多种卡拉OK效果，这是一个很好的选择。</p><p>当特效库函数被调用,它会首先为每个对话行调用 <em>&ldquo;fx_特效&rdquo;</em> 。举个例子,
如果某个对话行的特效栏填写的是 <em>&ldquo;jump&rdquo;</em>, 则名为 <code>fx_jump</code>
的函数将会被调用。对于特效栏为空的对话行, 函数 <code>fx_none</code> 将会被调用。</p><p>如果指明的 <code>fx</code>
函数并不存在，那么原始的行将会被保留。否则，原始行是否存在取决于 <code>fx</code>
函数在返回部分的写法。返回真值则意味着保留原始行，否则将会把原始行设置为注释行。</p><p><code>fx</code> 函数用法: <code>keep = fx_effect(subtitles, meta, styles, line, fxdata)</code></p><p><code>fxdata</code> 指的是特效栏中声明特效类型后紧跟的特效名称。 <code>fx</code>
函数的所有输出都是 <code>subtitles</code> 被处理后添加到字幕文件中的行。</p><p>简化的主函数: <code>karaskel.use_fx_library(add_macro)</code></p><p>与 <code>_furi</code> 变种相同，除了 <code>use_furigana</code> 被去除；它被假定为false。</p><h3 id=classic-advanced>Classic Advanced <a href=#classic-advanced class=anchor aria-hidden=true>#</a></h3><p>Main function: <code>karaskel.use_classic_adv(use_furigana, add_macro)</code></p><p>Call the <code>karaskel.use_classic_adv</code> function to install the Classic
Advanced skeleton for this script file. The <code>script_name</code> and
<code>script_description</code> globals are used to name the export filter produced.
If <code>use_furigana</code> is true, furigana styles are created and added as needed,
and furigana processing is enabled. If <code>add_macro</code> is true, a macro is
registered in addition to the export filter.</p><p>This skeleton is created in the image of the Automation 3 <code>karaskel-adv</code>
skeleton, but it is <em>not</em> compatible with it. (You cannot use a
<code>karaskel-adv</code> script with Classic Advanced without rewriting parts of your
script.) The basic premise is that the <code>do_syllable</code> function is called
once for each syllable. Optionally, you can have a function called for each
line, using the <code>do_line</code> function.</p><p>Classic Advanced uses a slightly different model than the usual Automation
4 Lua one. Here all subtitle lines are collected first before any further
processing is done. They also have <code>line.prev</code> and <code>line.next</code> fields
added, to allow linked list style access. To add lines to the output, you
must still add lines to the <code>subs</code> object though. Before processing starts,
all original lines are <em>deleted</em> from the <code>subs</code> object.</p><p>Signature of syllable function: <code>do_syllable(subs, meta, styles, lines, line, syl)</code></p><p>The syllable function <em>must</em> be named <code>do_syllable</code>. If furigana processing
is enabled, you can also define a function called <code>do_furigana</code> with the
same signature, to process furigana syllables. Furigana still follows the
Automation 4 model here.</p><p>Signature of line function: <code>do_line(subs, meta, styles, lines, line, default_do_line)</code></p><p>Defining a line function is optional, and is often not required. The line
function <em>must</em> be named <code>do_line</code> if it exists. The <code>default_do_line</code>
parameter is the function that would be called if <code>do_line</code> didn&rsquo;t exist.
You can call it to run the default line processing along with your own
processing.</p><h2 id=data-structures>Data structures <a href=#data-structures class=anchor aria-hidden=true>#</a></h2><p><code>karaskel.lua</code> defines and extends several data structures. Some of the
changes are already listed above under the individual functions.</p><h3 id=styles-array>Styles array <a href=#styles-array class=anchor aria-hidden=true>#</a></h3><p>The <code>styles</code> array is produced by the <code>karaskel.collect_head</code> function and
should be passed to most other <code>karaskel.lua</code> functions. It contains a list
of all styles in the subtitle file, and can be accessed in two ways.</p><p><code>styles.n</code> is a number telling the number of styles in the array.
<code>styles[1]</code> is the first defined style and <code>styles[styles.n]</code> is the last
defined style.</p><p>The <code>styles</code> array can also be indexed by style names, such that
<code>styles[style.name] == style</code>. The names are not mangled and the indexing
is case sensitive.</p><p>Be aware that modifying the <code>styles</code> will never update the subtitles file,
and conversely updating the styles in the subtitle file will not
automatically be reflected in <code>styles</code> either.</p><h3 id=style-table>Style table <a href=#style-table class=anchor aria-hidden=true>#</a></h3><p>This is a slight extension of the basic <code>style</code> class subtitle line structure.</p><p>One field is added:</p><ul><li><code>style.margin_v</code> is a convenience alias for <code>style.margin_t</code>.</li></ul><p>Full list of fields:</p><ul><li><code>style.class == "style"</code></li><li><code>style.raw</code> - The raw line text.</li><li><code>style.section == "[V4+ Styles]"</code></li><li><code>style.name</code> - Name of the style.</li><li><code>style.fontname</code> - Name of the font face used by the style.</li><li><code>style.fontsize</code> - Font size for the style.</li><li><code>style.color1</code>, <code>style.color2</code>, <code>style.color3</code> and <code>style.color4</code> - The
four colours used by the style, in regular order. Use
<a href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/#extractcolor><code>extract_color</code></a> and family to
manipulate these.</li><li><code>style.bold</code> - <code>true</code>/<code>false</code> to specify bold/non-bold font face. Can
also be a number to specify font weight, but this is not well supported
and should be avoided.</li><li><code>style.italic</code> - Boolean, whether an italic/oblique version of the font
face is used or not.</li><li><code>style.underline</code> and <code>style.strikeout</code> - Boolean, whether to apply these
two decorations to the text.</li><li><code>style.scale_x</code> and <code>style.scale_y</code> - Scaling in X and Y direction, 100
is neutral.</li><li><code>style.spacing</code> - Additional spacing in pixels between individual
characters in text.</li><li><code>style.angle</code> - Z axis rotation for the text.</li><li><code>style.borderstyle</code> - 1 (one) for regular outlined text, 3 for opaque
box behind subtitles.</li><li><code>style.outline</code> - Width of the extended outline around the text.</li><li><code>style.shadow</code> - Distance to the shadow behind the text.</li><li><code>style.align</code> - Numpad-style alignment for the text on screen.</li><li><code>style.margin_l</code>, <code>style.margin_r</code>, <code>style.margin_t</code> and <code>style.margin_b</code><ul><li>Margins for the style. <code>style.margin_v</code> is an alias for top margin.</li></ul></li><li><code>style.encoding</code> - Windows font encoding ID for the style.</li><li><code>style.relative_to</code> - Currently unsupported.</li><li><code>style.vertical</code> - Unsupported, tentative AS5 feature.</li></ul><h3 id=dialogue-line-table>Dialogue line table <a href=#dialogue-line-table class=anchor aria-hidden=true>#</a></h3><p>A large number of new fields have been added to the dialogue line class.</p><p>Basic fields:</p><ul><li><code>line.class == "dialogue"</code>, also for comment lines</li><li><code>line.raw</code> - The raw line text.</li><li><code>line.section</code> - Usually <code>"[Events]"</code>.</li><li><code>line.comment</code> - Boolean, true if the line is a Comment line rather than
Dialogue.</li><li><code>line.layer</code> - Layer of the line.</li><li><code>line.start_time</code>, <code>line.end_time</code> - Start and end times of the line in
milliseconds.</li><li><code>line.style</code> - Name of the style used for the line.</li><li><code>line.actor</code> - Actor field for the line.</li><li><code>line.margin_l</code>, <code>line.margin_r</code>, <code>line.margin_t</code> and <code>line.margin_b</code> -
Margin overrides for the line, a zero value means use margin from style.</li><li><code>line.effect</code> - Effect field of the line.</li><li><code>line.userdata</code> - Unused.</li><li><code>line.text</code> - Dialogue text.</li></ul><p>Basic added fields, by <code>karaskel.preproc_line_text</code>:</p><ul><li><code>line.text_stripped</code> - Line text with all override tags and vector
drawings removed.</li><li><code>line.duration</code> - Duration of the line in milliseconds</li><li><code>line.kara</code> and <code>line.furi</code> - Array tables of extended karaoke and
furigana tables, respectively. They do not contain sizing and positioning
data from the beginning.</li></ul><p>Added fields for sizing, by <code>karaskel.preproc_line_size</code>:</p><ul><li><code>line.styleref</code> - A reference to the Style table representing this line&rsquo;s
selected style.</li><li><code>line.furistyle</code> - A reference to the Style table representing this
line&rsquo;s furigana layout style. If there is no style with the right name,
this field is <code>false</code> instead.</li><li><code>line.width</code>, <code>line.height</code>, <code>line.descent</code> and <code>line.extlead</code> - Sizing
information for the stripped line text, as returned by
<code>aegisub.text_extents</code>. <code>line.width</code> may also be modified by
<code>karaskel.preproc_line_pos</code>.</li></ul><p>Added fields for positioning, by <code>karaskel.preproc_line_pos</code>:</p><ul><li><code>line.margin_v</code> - A convenience alias for <code>line.margin_t</code>.</li><li><code>line.eff_margin_l</code>, <code>line.eff_margin_r</code>, <code>line.eff_margin_t</code>,
<code>line.eff_margin_b</code> and <code>line.eff_margin_v</code> - Effective margin values for
the line. If the corresponding margin override for the line is non-zero,
that value is used, otherwise the value defined in the style is used.</li><li><code>line.halign</code> - One of <code>"left"</code>, <code>"center"</code> or <code>"right"</code>, the horizontal
alignment of the line, derived from <code>line.styleref.align</code>.</li><li><code>line.valign</code> - One of <code>"top"</code>, <code>"middle"</code> or <code>"bottom"</code>, the vertical
alignment of the line, derived from <code>line.styleref.align</code>.</li><li><code>line.left</code> - The left edge X coordinate for the line, assuming its given
alignment, effective margins and no collision detection.</li><li><code>line.center</code> - The line centre X coordinate, assuming its given
alignment, effective margins and no collision detection.</li><li><code>line.right</code> - The right edge X coordinate for the line, assuming its
given alignment, effective margins and no collision detection.</li><li><code>line.top</code> - The top edge Y coordinate for the line, assuming its given
alignment, effective margins and no collision detection.</li><li><code>line.middle</code> - The line vertical centre Y coordinate, assuming its given
alignment, effective margins and no collision detection <code>line.vcenter</code> is
an alias for this.</li><li><code>line.bottom</code> - The bottom edge Y coordinate for the line, assuming its
given alignment, effective margins and no collision detection.</li><li><code>line.x</code> and <code>line.y</code> - X and Y coordinates for the line, suitable for
using in a <code>\pos</code> override tag to get the line&rsquo;s original position.</li></ul><p>Added fields for linked list access, only available when using the Classic
Advanced skeleton:</p><ul><li><code>line.prev</code>, <code>line.next</code> - Access the dialogue line before and after this
one. These might be <code>nil</code> on the first/last dialogue lines. Blank lines,
style lines, header lines etc. are <em>not</em> included in this linked list.</li></ul><h3 id=karaoke-and-furigana-syllable-tables>Karaoke and furigana syllable tables <a href=#karaoke-and-furigana-syllable-tables class=anchor aria-hidden=true>#</a></h3><p>Tables for regular karaoke syllables and furigana parts are identical in
(almost) every aspect, and can usually be processed by the same code
without problems. There are a few points to take note of which are marked.
Everywhere it says <code>syl</code> here, you can replace that with <code>furi</code> unless
otherwise noted.</p><p>Basic fields, defined by <code>aegisub.parse_karaoke_data</code>:</p><ul><li><code>syl.duration</code> - syllable duration in milliseconds (divide by 10 to get a
number suitable for <code>\k</code> tags.)</li><li><code>syl.start_time</code>, <code>syl.end_time</code> - Start and end time of the syllable in
milliseconds, relative to the start time of the line.</li><li><code>syl.tag</code> - The name of the tag defining this syllable, without
backslash. It will usually be one of <code>k</code>, <code>K</code>, <code>kf</code> or <code>ko</code>. Note that
<code>kt</code> is not handled. Furigana parts have the same tag as the original
syllable defining them.</li><li><code>syl.text</code> - Text including tags of the syllable. Same as stripped text
for furigana.</li><li><code>syl.text_stripped</code> - Text of the syllable with all tags removed. For
main syllables, this also has furigana and multi-highlight parts removed.
This is the text you will usually want to use.</li></ul><p>Additions by <code>karaskel.preproc_line_text</code>:</p><ul><li><code>syl.kdur</code> - Syllable duration in centiseconds, suitable for use in <code>\k</code>
tags.</li><li><code>syl.line</code> - Back reference to the line table containing this syllable.</li><li><code>syl.inline_fx</code> - Name of the <a href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/karaoke_inline-fx/><em>inline-fx</em></a> for this
syllable.</li><li><code>syl.i</code> - Index number of this syllable.</li><li><code>syl.prespace</code>, <code>syl.postspace</code> - Space characaters at the start/end of
the syllable. Always blank for furigana. These are spaces included in
<code>syl.text_stripped</code>. You will usually never need this.</li><li><code>syl.text_spacestripped</code> - Syllable text stripped for tags and trimmed of
spaces at the start and end. This, <code>syl.prespace</code> and <code>syl.postspace</code>
together can produce the same as <code>syl.text_stripped</code>. You will usually
never need this.</li><li><code>syl.isfuri</code> - <code>true</code> if the table is a furigana table, <code>false</code> if it is
not. If you use a single function to process both regular and furigana
syllables, you can use this to do differentiated processing still.</li><li><code>syl.highlights</code> - Array table of multi-highlight data for the syllable.
For furigana, there is always exactly one highlight defined. See below
for format of highlight tables.</li></ul><p>Additions by <code>karaskel.preproc_line_size</code>:</p><ul><li><code>syl.style</code> - Reference to the style used to calculate sizing for this
syllable. This will be the main line style for regular syllables and the
furigana style for furigana. You should always set the style of the
generated lines to this one.</li><li><code>syl.width</code>, <code>syl.height</code> - Width and height of <code>syl.text_spacestripped</code>,
as returned by <code>aegisub.text_extents</code>.</li><li><code>syl.prespacewidth</code>, <code>syl.postspacewidth</code> - Width of <code>syl.prespace</code> and
<code>syl.postspace</code> respectively. You will usually not need these. Always
zero for furigana.</li></ul><p>Additions by <code>karaskel.preproc_line_pos</code>:</p><ul><li><code>syl.left</code>, <code>syl.center</code>, <code>syl.right</code> - Respectively left, center and
right aligned positions of the syllable/furigana, for use with different
alignments. The positions are <em>relative to the left edge of the line</em>,
meaning you will need to add a value for line positioning to use these
values to position syllables on screen. There is no guarantee that
<code>syl.right</code> for one syllable is equal to <code>syl.left</code> for the next
syllable.</li></ul><div class=card><strong class=card-header>Example</strong><div class=card-body><pre><code class=language-lua>line.left + syl.center
</code></pre><p>Calculates the default X position of a syllable, suitable for use with
<code>\an2</code>, <code>\an5</code> or <code>\an8</code> alignment.</p></div></div><h4 id=highlight-table>Highlight table <a href=#highlight-table class=anchor aria-hidden=true>#</a></h4><p>A highlight table defines one highlight of a multi-highlight timed
syllable.</p><p>Highlight tables are entirely defined by <code>karaskel.preproc_line_text</code>, and
contain the following fields:</p><ul><li><code>hl.start_time</code>, <code>hl.end_time</code> - Start and end time of the highlight, in
milliseconds, relative to the start of the line.</li><li><code>hl.duration</code> - Duration of the highlight in milliseconds.</li></ul><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="docs-navigation d-flex justify-content-between"><a href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/><div class="card my-1"><div class="card-body py-2">&larr; Lua模块</div></div></a><a class=ms-auto href=https://aegisub.github.io/aegisite/zh-cn/docs/latest/automation/lua/modules/util/><div class="card my-1"><div class="card-body py-2">utils.lua &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container-fluid><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a class=text-muted href=https://gohugo.io/>Hugo</a> and <a class=text-muted href=https://getdoks.org/>Doks</a>.<br>Copyright (c) AegiSite <a href=https://github.com/Aegisub/aegisite/graphs/contributors>contributors</a> and <a href=https://github.com/computerfan/Chinese-aegisite/graphs/contributors>translators</a>.</li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline><li class=list-inline-item><a href=https://aegisub.github.io/aegisite/privacy-policy/>Privacy</a></li></ul></div></div></div></footer><script src=https://aegisub.github.io/aegisite/js/bootstrap.min.0a0106334435d4110713bfaff4acaf02533b0c56d44412a74e9518db07672ddb7e099a9c7517bc9cb529e2ddd4ae2e438b40b720288900d5e74fb6d8928d9097.js integrity="sha512-CgEGM0Q11BEHE7+v9KyvAlM7DFbURBKnTpUY2wdnLdt+CZqcdRe8nLUp4t3Uri5Di0C3ICiJANXnT7bYko2Qlw==" crossorigin=anonymous defer></script>
<script src=https://aegisub.github.io/aegisite/js/highlight.min.4f51b93ee96c3e2c0e1671986624888b24b9b8bfee2a20aa0556d7f3a61098d5c094012a22f5ed6f904b570b0554a4473114d439df142e1018d751582d3470f6.js integrity="sha512-T1G5PulsPiwOFnGYZiSIiyS5uL/uKiCqBVbX86YQmNXAlAEqIvXtb5BLVwsFVKRHMRTUOd8ULhAY11FYLTRw9g==" crossorigin=anonymous defer></script>
<script src=https://aegisub.github.io/aegisite/main.min.6f7a46bd1f121978f9b99a72930700eeeea078245b498f61330d43745353ee2a541491c87fd8307512f49a752b386387e2c265a11377ecce26a2acb8fa24fecf.js integrity="sha512-b3pGvR8SGXj5uZpykwcA7u6geCRbSY9hMw1DdFNT7ipUFJHIf9gwdRL0mnUrOGOH4sJloRN37M4moqy4+iT+zw==" crossorigin=anonymous defer></script></body></html>