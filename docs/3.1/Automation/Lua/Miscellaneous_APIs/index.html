<!DOCTYPE html>
<html>

<!-- Mirrored from docs.aegisub.org/3.1/Automation/Lua/Miscellaneous_APIs/ by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 08 Jul 2020 19:49:13 GMT -->
<head>
<meta charset='utf-8'>
<title>Miscellaneous APIs - Aegisub Manual</title>
<meta content='Aegisub, Subtitles, VSFilter, Medusa, Sabbu, ' name='Keywords'>
<meta content='http://www.aegisub.org/' name='Author'>
<meta content='Copyright (C) 2012 Aegisub Project.' name='Copyright'>
<link href='../../../../3.2/Automation/Lua/Miscellaneous_APIs/index.html' rel='canonical'>
<link href="../../../img/favicon.ico" rel="icon" type="image/ico" />
<link href="../../../css/style-144d38ad.css" media="screen" rel="stylesheet" type="text/css" />
</head>
<body>
<div class='navbar navbar-fixed-top'>
<div class='navbar-inner'>
<div class='container-fluid'>
<a class="brand" style="padding: 3px 10px" href="http://www.aegisub.org/"><img alt="Aegisub" width="82" height="33" src="../../../img/logo-top-bar-aeef0634.png" />
</a>
<ul class='nav'>
<li>
<a href="http://www.aegisub.org/">Home</a>
</li>
<li>
<a href="http://blog.aegisub.org/">News</a>
</li>
<li>
<a href="http://www.aegisub.org/downloads/">Downloads</a>
</li>
<li class='active'>
<a href="../../../../index.html">Manual</a>
</li>
<li>
<a href="http://devel.aegisub.org/">Bug Tracker</a>
</li>
<li>
<a href="http://forum.aegisub.org/">Forum</a>
</li>
<li>
<a href="irc://irc.rizon.net/aegisub">IRC</a>
</li>
</ul>
<ul class='nav pull-right'>
<li>
<form action='https://www.paypal.com/cgi-bin/webscr' method='post' style='padding: 13px 0 6px 0; margin: 0' target='_top'>
<input name='cmd' type='hidden' value='_s-xclick'>
<input name='encrypted' type='hidden' value='-----BEGIN PKCS7-----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-----END PKCS7-----'>
<input alt='PayPal - The safer, easier way to pay online!' border='0' name='submit' src='https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif' type='image'>
<img alt='' border='0' height='1' src='https://www.paypalobjects.com/en_US/i/scr/pixel.gif' width='1'>
</form>
</li>
<li>
<a href='http://flattr.com/thing/922938/Aegisub-Advanced-Subtitle-Editor' target='_blank'>
<img alt='Flattr this' src='http://api.flattr.com/button/flattr-badge-large.png' title='Flattr this'>
</a>
</li>
</ul>
</div>
</div>
</div>
<div class='fluid-row'>
<div class='span3'>
<ul id='manual-sidebar'>
<li class='nav-header'>Navigation</li>
<li>
<a href="../../../Main_Page/index.html">Main Page</a>
</li>
<li class='nav-header'>Introduction</li>
<li>
<a href="../../../About/index.html">What is Aegisub?</a>
</li>
<li>
<a href="../../../Highlights/index.html">Highlights</a>
</li>
<li>
<a href="../../../Credits/index.html">Credits</a>
</li>
<li>
<a href="../../../Support/index.html">Support Aegisub</a>
</li>
<li>
<a href="../../../FAQ/index.html">FAQ</a>
</li>
<li>
<a href="../../../Tutorials/index.html">Tutorials</a>
</li>
<li class='nav-header'>Working with Subtitles</li>
<li>
<a href="../../../Editing_Subtitles/index.html">Editing Subtitles</a>
</li>
<li>
<a href="../../../Exporting/index.html">Exporting Subtitles</a>
</li>
<li>
<a href="../../../Attaching_subtitles_to_video/index.html">Applying Subtitles</a>
</li>
<li>
<a href="../../../Spell_Checker/index.html">Spell Checker</a>
</li>
<li>
<a href="../../../Translation_Assistant/index.html">Translation Assistant</a>
</li>
<li>
<a href="../../../Paste_Over/index.html">Paste Over</a>
</li>
<li>
<a href="../../../Select_Lines/index.html">Select Lines</a>
</li>
<li class='nav-header'>Typesetting</li>
<li>
<a href="../../../Typesetting/index.html">Introduction</a>
</li>
<li>
<a href="../../../Video/index.html">Working with Video</a>
</li>
<li>
<a href="../../../Styles/index.html">Editing styles</a>
</li>
<li>
<a href="../../../Visual_Typesetting/index.html">Visual Typesetting</a>
</li>
<li>
<a href="../../../ASS_Tags/index.html">ASS Override Tags</a>
</li>
<li>
<a href="../../../Colour_Picker/index.html">Colour Picker</a>
</li>
<li>
<a href="../../../Styling_Assistant/index.html">Styling Assistant</a>
</li>
<li>
<a href="../../../Resolution_Resampler/index.html">Resolution Resampler</a>
</li>
<li>
<a href="../../../Fonts_Collector/index.html">Fonts Collector</a>
</li>
<li class='nav-header'>Timing</li>
<li>
<a href="../../../Audio/index.html">Working with Audio</a>
</li>
<li>
<a href="../../../Timing/index.html">Timing subtitles to audio</a>
</li>
<li>
<a href="../../../Shift_Times/index.html">Shift times</a>
</li>
<li>
<a href="../../../Timing_Post-Processor/index.html">Timing Post-Processor</a>
</li>
<li>
<a href="../../../Kanji_Timer/index.html">Kanji Timer</a>
</li>
<li class='nav-header'>Automation</li>
<li>
<a href="../../index.html">Overview</a>
</li>
<li>
<a href="../../Karaoke_Templater/index.html">Karaoke Templater</a>
</li>
<li>
<a href="../index.html">Lua Reference</a>
</li>
<li class='nav-header'>Miscellaneous</li>
<li>
<a href="../../../Options/index.html">Aegisub Options</a>
</li>
<li>
<a href="../../../Properties/index.html">Script Properties</a>
</li>
<li>
<a href="../../../Attachment_Manager/index.html">Attachment Manager</a>
</li>
</ul>
</div>
<div class='span9' id='manual-body'>
<h1 class='page-header'><a href="../../index.html">Automation</a> / <a href="../index.html">Lua</a> / Miscellaneous APIs</h1>
<ol id="markdown-toc">
  <li><a href="#aegisubcancel">aegisub.cancel</a></li>
  <li><a href="#aegisubtextextents">aegisub.text_extents</a></li>
  <li><a href="#aegisubgettext">aegisub.gettext</a></li>
  <li><a href="#getting-information-on-the-video">Getting information on the video</a>    <ol>
      <li><a href="#aegisubframefromms">aegisub.frame_from_ms</a></li>
      <li><a href="#aegisubmsfromframe">aegisub.ms_from_frame</a></li>
      <li><a href="#aegisubvideosize">aegisub.video_size</a></li>
      <li><a href="#aegisubkeyframes">aegisub.keyframes</a></li>
    </ol>
  </li>
  <li><a href="#aegisubdecodepath">aegisub.decode_path</a></li>
</ol>

<p>This page documents <strong>miscellaneous APIs useful for working with
subtitles</strong>. These can't be clearly placed into any of the other main
categories and there's too few of each kind to warrant a separate category.</p>

<h2 id="aegisubcancel">aegisub.cancel</h2>
<p>Synopsis: <code>aegisub.cancel()</code></p>

<p>Immediately end execution of the current script, rolling back any changes
that have been made in it.</p>

<p>This function never returns.</p>

<h2 id="aegisubtextextents">aegisub.text_extents</h2>
<p>Synopsis: <code>width, height, descent, ext_lead = aegisub.text_extents(style, text)</code></p>

<p>Obtain system font metrics and determine the rendered size in pixels of the
given <strong>text</strong> when using the <strong>style</strong>.</p>

<dl>
  <dt><strong><code>@style</code></strong> (<code>table</code>)</dt>
  <dd>A <a href="../Subtitle_file_interface/index.html#styletable">style
table</a> as defined by
the subtitle interface. The font name, size, weight, style, spacing and
encoding is used to determine the size of the text.</dd>
  <dt><strong><code>@text</code></strong> (<code>string</code>)</dt>
  <dd>The text the extents should be determined for. This
should not contain line breaks (<code>\n</code> or <code>\r\n</code>) nor should it contain
formatting codes of any kind. Formatting codes are not interpreted and
will be taken as verbatim text.</dd>
  <dt><strong><code>width</code></strong> (<code>number</code>)</dt>
  <dd>Width in pixels of text. This may be non-integer.</dd>
  <dt><strong><code>height</code></strong> (<code>number</code>)</dt>
  <dd>Height in pixels of the text. This may be non-integer.</dd>
  <dt><strong><code>descent</code></strong> (<code>number</code>)</dt>
  <dd>Length of descenders in the font. This may be
non-integer.</dd>
  <dt><strong><code>ext_lead</code></strong> (<code>number</code>)</dt>
  <dd>External leading for the font. This may be non-integer.</dd>
</dl>

<p>You should only feed plain text strings without line breaks into this
function. It cannot handle any kind of formatting codes or text layout.
Rather, it is intended as a helper to create text layouts by determining
rendered sizes of bits and pieces of a longer text, which can then be
laid out by the script.</p>

<h2 id="aegisubgettext">aegisub.gettext</h2>
<p>Synopsis: <code>translation = aegisub.gettext(untranslated)</code></p>

<p>Get the translation for a string. This is mostly only intended for scripts
bundled with Aegisub (as there's no way for you to add your own
translations), but if you happen to be using strings that are present in
Aegisub it may be useful.</p>

<p>Note that in the bundled macros this is always aliased to <code>tr</code> for the sake
of the string extractor.</p>

<h2 id="getting-information-on-the-video">Getting information on the video</h2>
<p>Automation 4 Lua offers two functions designed to be able to work with
frame-based timing without having to consider whether the video source is
VFR or CFR.</p>

<p>The primary purpose of these functions is to be able to generate per-frame
effects, i.e. get the timestamps of a number of sequential frames and
calculate coordinates, sizes etc. for an object for each of those frames.</p>

<p>One thing to remember when using these functions is that, considering a
one-dimensional time line, a time stamp is a point on the time line, while
a video frame spans a range of the time line, from its beginning time to
its ending time. The ending time of a frame is the beginning time of the
next. The beginning time of a frame is included in the range while the
ending time is excluded from the range.</p>

<h3 id="aegisubframefromms">aegisub.frame_from_ms</h3>
<p>Synopsis: <code>frame = aegisub.frame_from_ms(ms)</code></p>

<p>Use loaded frame rate data to convert an absolute time given in
<strong>milliseconds</strong> into a <strong>frame</strong> number.</p>

<dl>
  <dt><strong><code>@ms</code></strong> (<code>number</code>)</dt>
  <dd>Absolute time from the beginning of the video, for
which to determine the frame number.</dd>
  <dt><strong><code>frame</code></strong> (<code>number</code>)</dt>
  <dd>Frame number corresponding to the time in ms, or <code>nil</code> if there is no
frame rate data loaded.</dd>
</dl>

<p>If the time is in the middle of the frame it is <strong>rounded down</strong> to the frame
number that contains the given time.</p>

<h3 id="aegisubmsfromframe">aegisub.ms_from_frame</h3>
<p>Synopsis: <code>ms = aegisub.ms_from_frame(frame)</code></p>

<p>Use loaded frame rate data to convert a <strong>frame</strong> number of the video into
an absolute time in <strong>milliseconds</strong>.</p>

<dl>
  <dt><strong><code>@frame</code></strong> (<code>number</code>)</dt>
  <dd>Frame to obtain the beginning time of.</dd>
  <dt><strong><code>ms</code></strong> (<code>number</code>)</dt>
  <dd>First integer millisecond time stamp to lie within the frame, or <code>nil</code> if
there is no frame rate data loaded.</dd>
</dl>

<p>Because beginning times of frames can have better precision than one
millisecond this function rounds up and returns the first whole millisecond
that is guaranteed to be within the frame.</p>

<h3 id="aegisubvideosize">aegisub.video_size</h3>
<p>Synopsis: <code>xres, yres, ar, artype = aegisub.video_size()</code></p>

<p>Get information about the resolution and aspect-ratio of the loaded video,
if any.</p>

<dl>
  <dt><strong><code>xres</code></strong> (<code>number</code>)</dt>
  <dd>Coded width of the video in pixels, or <code>nil</code> if there is no video loaded.</dd>
  <dt><strong><code>yres</code></strong> (<code>number</code>)</dt>
  <dd>Coded height of the video in pixels, or <code>nil</code> if there is no video loaded.</dd>
  <dt><strong><code>ar</code></strong> (<code>number</code>)</dt>
  <dd>Custom display aspect ratio override. Meaningless unless <code>artype</code> is 4.</dd>
  <dt><strong><code>artype</code></strong> (<code>number</code>)</dt>
  <dd>There are 5 values that <code>artype</code> can take:

    <ul>
      <li>0: The video has square pixels, i.e. PAR is 1.00 and DAR is <code>xres</code>/<code>yres</code>.</li>
      <li>1: The video is 4:3, i.e. DAR is 1.33.</li>
      <li>2: The video is 16:9, i.e. DAR is 1.78.</li>
      <li>3: The video is 2.35 format, i.e. DAR is 2.35.</li>
      <li>4: The DAR is whatever the <code>ar</code> return value contains.</li>
    </ul>
  </dd>
</dl>

<h3 id="aegisubkeyframes">aegisub.keyframes</h3>
<p>Synopsis <code>keyframes = aegisub.keyframes()</code></p>

<p>Get a list of what video frames are keyframes.</p>

<dl>
  <dt><strong><code>keyframes</code></strong> (<code>table</code>)</dt>
  <dd>A sorted table where each entry is the frame number of a keyframe. If
no keyframe data is loaded, the table will be empty.</dd>
</dl>

<h2 id="aegisubdecodepath">aegisub.decode_path</h2>
<p>Synopsis <code>path = aegisub.decode_path(encoded_path)</code></p>

<p>Convert a path beginning with a <a href="../../../Aegisub_path_specifiers/index.html">path specifier</a>
to an absolute path.</p>

<dl>
  <dt><strong><code>@encoded_path</code></strong> (<code>string</code>)</dt>
  <dd>A string which may optionally begin with an Aegisub <a href="../../../Aegisub_path_specifiers/index.html">path specifier</a>.</dd>
  <dt><strong><code>@path</code></strong> (<code>string</code>)</dt>
  <dd>If <code>encoded_path</code> began with a valid <a href="../../../Aegisub_path_specifiers/index.html">path
specifier</a>, an absolute path. If it began with an
invalid path specifier (such as if ?video was used when no video is open),
a string that is unlikely to be useful in any way. Any other strings are
passed through untouched.</dd>
</dl>

<div class='navbox'>
<div><a href="../../index.html">Automation</a></div>
<table>
<tr>
<th>Overview:</th>
<td><a href="../../Manager/index.html">Automation Manager</a> • <a href="../../Running_macros/index.html">Running macros</a> • <a href="../../../Exporting/index.html">Using export filters</a> • <a href="../../Included_macros/index.html">Standard macros</a></td>
</tr>
<tr>
<th><a href="../../Karaoke_Templater/index.html">Karaoke Templater</a> reference:</th>
<td><a href="../../Karaoke_Templater/Declaring_template_and_code_lines/index.html">Declaring templates</a> • <a href="../../Karaoke_Templater/Template_execution_rules_and_order/index.html">Execution order</a> • <a href="../../Karaoke_Templater/Template_modifiers/index.html">Modifiers</a> • <a href="../../Karaoke_Templater/Inline_variables/index.html">Inline-variables ($-variables)</a> <br> <a href="../../Karaoke_Templater/Code_lines_and_blocks/index.html">Code lines and blocks</a> • <a href="../../Karaoke_Templater/Code_execution_environment/index.html">Execution envirionment</a></td>
</tr>
<tr>
<th><a href="../index.html">Lua API</a>  reference:</th>
<td><a href="../Registration/index.html">Registration</a> • <a href="../Subtitle_file_interface/index.html">Subtitles object</a> • <a href="../Progress_reporting/index.html">Progress reporting</a> • <a href="../Dialogs/index.html">Dialogs</a> • <a href="index.html">Misc. APIs</a></td>
</tr>
<tr>
<th><a href="../Modules/index.html">Lua Modules</a>:</th>
<td><a href="../Modules/karaskel.lua/index.html">karaskel.lua</a> • <a href="../Modules/util/index.html">util</a> • <a href="../Modules/unicode/index.html">unicode</a> • <a href="#">cleantags.lua</a> • <a href="../Modules/clipboard/index.html">clipboard</a> • <a href="../Modules/re/index.html">re</a></td>
</tr>
<tr>
<th>Karaskel concepts:</th>
<td><a href="../Modules/karaskel.lua/index.html#Style_table">Style tables</a> • <a href="../Modules/karaskel.lua/index.html#Dialogue_line_table">Dialogue line tables</a> • <a href="../Modules/karaskel.lua/index.html#Karaoke_and_furigana_syllable_tables">Syllable tables</a> • <a href="../../../Karaoke_inline-fx/index.html">Inline effects</a> • <a href="../../../Furigana_karaoke/index.html">Furigana</a></td>
</tr>
</table>
</div>

</div>
</div>

<footer class='footer span12 pagination-centered'>
<p>
Hosting kindly provided by
<a href='http://www.networkredux.com/'>NetworkRedux</a>
</p>
</footer>
</body>

<!-- Mirrored from docs.aegisub.org/3.1/Automation/Lua/Miscellaneous_APIs/ by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 08 Jul 2020 19:49:13 GMT -->
</html>

